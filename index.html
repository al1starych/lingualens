<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>LinguaLens | Learn Languages with Birkenbihl Method</title>
  <meta name="description" content="LinguaLens helps you learn foreign languages more effectively using the Birkenbihl method - decoding languages word by word">
  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  <link
    href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap"
    rel="stylesheet"
  />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
  <style>
    :root {
      --primary: #5b68ff;
      --primary-dark: #4355f0;
      --primary-light: #e8ebff;
      --secondary: #ff6b6b;
      --secondary-dark: #ff5252;
      --text: #2a2f45;
      --text-light: #6c757d;
      --bg: #fcfdff;
      --card-bg: #ffffff;
      --border: #e4e8f0;
      --success: #28a745;
      --info: #17a2b8;
      --warning: #ffc107;
      --danger: #dc3545;
    }
    .dark-mode {
      --primary: #7c86ff;
      --primary-dark: #6169ff;
      --primary-light: #282f60;
      --secondary: #ff8585;
      --secondary-dark: #ff6969;
      --text: #f1f3f5;
      --text-light: #adb5bd;
      --bg: #121826;
      --card-bg: #1e293b;
      --border: #2c3a52;
    }
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }
    body {
      font-family: "Inter", sans-serif;
      background-color: var(--bg);
      color: var(--text);
      line-height: 1.6;
      transition: all 0.3s ease;
    }
    .container {
      max-width: 1140px;
      margin: 0 auto;
      padding: 2rem;
    }
    header {
      text-align: center;
      margin-bottom: 3rem;
      animation: fadeIn 0.8s ease;
    }
    .logo-container {
      margin-bottom: 1rem;
      display: inline-block;
      position: relative;
    }
    .logo-text {
      font-size: 3.5rem;
      font-weight: 800;
      background: linear-gradient(90deg, var(--primary), var(--secondary));
      -webkit-background-clip: text;
      background-clip: text;
      color: transparent;
      margin-bottom: 0.5rem;
      animation: pulse 5s infinite alternate;
    }
    .logo-badge {
      position: absolute;
      top: -5px;
      right: -40px;
      background: var(--secondary);
      color: white;
      font-size: 0.8rem;
      padding: 0.2rem 0.5rem;
      border-radius: 20px;
      font-weight: 600;
      transform: rotate(15deg);
      box-shadow: 0 3px 6px rgba(0, 0, 0, 0.1);
    }
    .tagline {
      font-size: 1.3rem;
      color: var(--text-light);
      max-width: 600px;
      margin: 0 auto;
      line-height: 1.5;
    }
    .info-box {
      background: var(--primary-light);
      border-radius: 0.75rem;
      padding: 1.5rem;
      margin-bottom: 2rem;
      display: flex;
      align-items: flex-start;
      animation: slideUp 0.8s ease;
      box-shadow: 0 4px 6px rgba(91, 104, 255, 0.1);
    }
    .info-icon {
      margin-right: 1rem;
      font-size: 1.5rem;
      color: var(--primary);
    }
    .info-content h3 {
      margin-bottom: 0.5rem;
      font-weight: 600;
      color: var(--primary-dark);
    }
    .info-content p {
      color: var(--text);
      font-size: 0.95rem;
    }
    .controls-container {
      display: flex;
      flex-direction: column;
      gap: 2rem;
      margin-bottom: 2rem;
      animation: slideUp 0.6s ease;
    }
    .language-controls {
      display: flex;
      justify-content: center;
      gap: 2rem;
      margin-bottom: 1rem;
      flex-wrap: wrap;
    }
    .language-selector {
      display: flex;
      flex-direction: column;
      min-width: 200px;
    }
    .language-selector label {
      margin-bottom: 0.5rem;
      font-weight: 500;
      display: flex;
      align-items: center;
    }
    .language-selector label i {
      margin-right: 0.5rem;
      color: var(--primary);
    }
    .quick-actions {
      display: flex;
      justify-content: center;
      gap: 1rem;
      margin-bottom: 1rem;
    }
    .action-btn {
      padding: 0.5rem 1rem;
      background: var(--primary-light);
      color: var(--primary);
      border: none;
      border-radius: 0.5rem;
      font-size: 0.9rem;
      font-weight: 500;
      cursor: pointer;
      transition: all 0.3s ease;
      display: flex;
      align-items: center;
    }
    .action-btn i {
      margin-right: 0.5rem;
    }
    .action-btn:hover {
      background: var(--primary);
      color: white;
    }
    select {
      padding: 0.85rem 1.2rem;
      border-radius: 0.75rem;
      border: 1px solid var(--border);
      font-size: 1rem;
      background-color: var(--card-bg);
      box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
      transition: all 0.3s ease;
      color: var(--text);
      -webkit-appearance: none;
      -moz-appearance: none;
      appearance: none;
      background-image: url("data:image/svg+xml;charset=US-ASCII,%3Csvg%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22%20width%3D%22292.4%22%20height%3D%22292.4%22%3E%3Cpath%20fill%3D%22%23007CB2%22%20d%3D%22M287%2069.4a17.6%2017.6%200%200%200-13-5.4H18.4c-5%200-9.3%201.8-12.9%205.4A17.6%2017.6%200%200%200%200%2082.2c0%205%201.8%209.3%205.4%2012.9l128%20127.9c3.6%203.6%207.8%205.4%2012.8%205.4s9.2-1.8%2012.8-5.4L287%2095c3.5-3.5%205.4-7.8%205.4-12.8%200-5-1.9-9.2-5.5-12.8z%22%2F%3E%3C%2Fsvg%3E");
      background-repeat: no-repeat;
      background-position: right 1rem top 50%;
      background-size: 0.65rem auto;
      padding-right: 2.5rem;
    }
    select:focus {
      outline: none;
      border-color: var(--primary);
      box-shadow: 0 0 0 3px rgba(91, 104, 255, 0.2);
    }
    .input-area {
      margin-bottom: 2rem;
      animation: slideUp 0.6s ease;
    }
    .textarea-container {
      position: relative;
      margin-bottom: 1rem;
    }
    textarea {
      width: 100%;
      height: 150px;
      padding: 1.25rem;
      border-radius: 0.75rem;
      border: 1px solid var(--border);
      font-family: inherit;
      font-size: 1rem;
      resize: vertical;
      transition: all 0.3s ease;
      box-shadow: 0 4px 6px rgba(0, 0, 0, 0.05);
      color: var(--text);
      background-color: var(--card-bg);
    }
    textarea:focus {
      outline: none;
      border-color: var(--primary);
      box-shadow: 0 0 0 3px rgba(91, 104, 255, 0.2);
    }
    .character-count {
      position: absolute;
      bottom: 0.5rem;
      right: 0.5rem;
      font-size: 0.8rem;
      color: var(--text-light);
      pointer-events: none;
    }
    .example-texts {
      display: flex;
      flex-wrap: wrap;
      gap: 0.5rem;
      margin-bottom: 1rem;
    }
    .example-text {
      font-size: 0.85rem;
      padding: 0.4rem 0.75rem;
      background: var(--primary-light);
      color: var(--primary);
      border-radius: 0.5rem;
      cursor: pointer;
      transition: all 0.2s ease;
    }
    .example-text:hover {
      background: var(--primary);
      color: white;
    }
    .btn-container {
      display: flex;
      justify-content: center;
      gap: 1rem;
    }
    button.primary-button {
      display: inline-flex;
      align-items: center;
      justify-content: center;
      padding: 0.85rem 2.5rem;
      border: none;
      border-radius: 0.5rem;
      background: linear-gradient(90deg, var(--primary), #7664ff);
      color: white;
      font-family: inherit;
      font-size: 1rem;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s ease;
      box-shadow: 0 4px 10px rgba(91, 104, 255, 0.3);
    }
    button.primary-button i {
      margin-right: 0.5rem;
    }
    button.primary-button:hover {
      transform: translateY(-2px);
      box-shadow: 0 6px 15px rgba(91, 104, 255, 0.4);
    }
    button.primary-button:active {
      transform: translateY(0);
    }
    button.secondary-button {
      display: inline-flex;
      align-items: center;
      justify-content: center;
      padding: 0.85rem 2rem;
      border: 1px solid var(--border);
      border-radius: 0.5rem;
      background: var(--card-bg);
      color: var(--text);
      font-family: inherit;
      font-size: 1rem;
      font-weight: 500;
      cursor: pointer;
      transition: all 0.3s ease;
    }
    button.secondary-button i {
      margin-right: 0.5rem;
    }
    button.secondary-button:hover {
      background: var(--primary-light);
      color: var(--primary);
      border-color: var(--primary-light);
    }
    .output-area {
      background-color: var(--card-bg);
      border-radius: 1rem;
      box-shadow: 0 8px 20px rgba(0, 0, 0, 0.08);
      padding: 2rem;
      margin-top: 2rem;
      opacity: 0;
      transform: translateY(20px);
      transition: all 0.5s ease;
    }
    .output-area.visible {
      opacity: 1;
      transform: translateY(0);
    }
    .output-header {
      display: flex;
      justify-content: space-between;
      margin-bottom: 1.5rem;
      padding-bottom: 1rem;
      border-bottom: 1px solid var(--border);
    }
    .output-title {
      font-size: 1.25rem;
      font-weight: 600;
      color: var(--text);
    }
    .output-actions {
      display: flex;
      gap: 1rem;
    }
    .output-action {
      background: none;
      border: none;
      color: var(--primary);
      font-size: 1rem;
      cursor: pointer;
      transition: all 0.2s ease;
      display: flex;
      align-items: center;
    }
    .output-action i {
      margin-right: 0.3rem;
    }
    .output-action:hover {
      color: var(--primary-dark);
    }
    .sentence-block {
      margin-bottom: 2rem;
      padding: 2rem 2rem 2.5rem 2rem;
      border-bottom: 1px solid var(--border);
      position: relative;
      transition: all 0.3s ease;
    }
    .sentence-block:hover {
      background-color: var(--primary-light);
      border-radius: 0.5rem;
    }
    .sentence-block:last-child {
      margin-bottom: 0;
      padding-bottom: 0;
      border-bottom: none;
    }
    .sentence-header {
      display: flex;
      justify-content: space-between;
      margin-bottom: 1rem;
    }
    .sentence-number {
      font-size: 0.9rem;
      font-weight: 500;
      color: var(--text-light);
    }
    .original {
      font-size: 1.35rem;
      margin-bottom: 1rem;
      line-height: 1.8;
      font-weight: 500;
    }
    .word-mapping {
      font-size: 1.1rem;
      margin-bottom: 1rem;
      color: var(--primary);
      line-height: 1.8;
    }
    .translation {
      font-size: 1rem;
      color: var(--text-light);
      font-style: italic;
      margin-bottom: 1rem;
    }
    .word {
      display: inline-block;
      position: relative;
      cursor: pointer;
      transition: all 0.2s ease;
      padding: 0 0.1rem;
      border-radius: 0.2rem;
    }
    .word:hover {
      color: var(--secondary);
      background-color: rgba(255, 107, 107, 0.1);
    }
    .tooltip {
      position: absolute;
      bottom: 100%;
      left: 50%;
      transform: translateX(-50%);
      background-color: var(--primary-light);
      color: var(--primary);
      padding: 0.5rem 1rem;
      border-radius: 0.5rem;
      font-size: 0.9rem;
      white-space: nowrap;
      opacity: 0;
      pointer-events: none;
      transition: opacity 0.3s ease;
      box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
      z-index: 10;
    }
    .word:hover .tooltip {
      opacity: 1;
    }
    .sentence-actions {
      display: flex;
      gap: 1rem;
      margin-top: 1rem;
    }
    .sentence-action {
      display: flex;
      align-items: center;
      background: none;
      border: none;
      color: var(--text-light);
      font-size: 0.9rem;
      cursor: pointer;
      transition: all 0.2s ease;
    }
    .sentence-action i {
      margin-right: 0.3rem;
    }
    .sentence-action:hover {
      color: var(--primary);
    }
    /* Per-sentence speak button positioned at bottom right */
    .speak-btn {
      position: absolute;
      bottom: 10px;
      right: 10px;
      border: none;
      background: var(--primary-light);
      cursor: pointer;
      padding: 0.5rem;
      border-radius: 50%;
      transition: all 0.3s ease;
      display: flex;
      align-items: center;
      justify-content: center;
      box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
    }
    .speak-btn:hover {
      background: var(--primary);
    }

    .speak-btn i {
      color: var(--primary);
    }

    .speak-btn:hover i {
      color: #fff;
    }
    
    .speak-btn img {
      width: 20px;
      height: 20px;
    }
    .loading {
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      min-height: 200px;
      gap: 1rem;
    }
    .spinner {
      width: 40px;
      height: 40px;
      border: 4px solid rgba(91, 104, 255, 0.2);
      border-left-color: var(--primary);
      border-radius: 50%;
      animation: spin 1s linear infinite;
    }
    .loading-text {
      color: var(--text-light);
      font-size: 0.9rem;
    }
    .processing-steps {
      margin-top: 1rem;
      font-size: 0.85rem;
      color: var(--text-light);
    }
    .processing-step {
      display: flex;
      align-items: center;
      margin-bottom: 0.4rem;
    }
    .processing-step.completed {
      color: var(--success);
    }
    .processing-step i {
      margin-right: 0.4rem;
    }
    .error {
      color: var(--danger);
      text-align: center;
      padding: 2rem;
      background-color: rgba(220, 53, 69, 0.1);
      border-radius: 0.5rem;
    }
    .error i {
      font-size: 2rem;
      margin-bottom: 1rem;
    }
    .error h3 {
      margin-bottom: 0.5rem;
    }
    .error p {
      margin-bottom: 1rem;
    }
    .retry-btn {
      display: inline-flex;
      align-items: center;
      justify-content: center;
      padding: 0.5rem 1rem;
      background: var(--danger);
      color: white;
      border: none;
      border-radius: 0.5rem;
      font-size: 0.9rem;
      font-weight: 500;
      cursor: pointer;
      transition: all 0.3s ease;
    }
    .retry-btn i {
      margin-right: 0.5rem;
      font-size: 0.9rem;
    }
    .retry-btn:hover {
      background: #c82333;
    }
    .saved-translations {
      background: var(--card-bg);
      border-radius: 1rem;
      margin-top: 2rem;
      padding: 1.5rem;
      animation: fadeIn 0.8s ease;
      box-shadow: 0 4px 10px rgba(0, 0, 0, 0.05);
      display: none;
    }
    .saved-translations.visible {
      display: block;
    }
    .saved-translations h2 {
      font-size: 1.25rem;
      margin-bottom: 1rem;
      display: flex;
      align-items: center;
    }
    .saved-translations h2 i {
      margin-right: 0.5rem;
      color: var(--primary);
    }
    .saved-list {
      max-height: 300px;
      overflow-y: auto;
    }
    .saved-item {
      padding: 1rem;
      border-bottom: 1px solid var(--border);
      cursor: pointer;
      transition: all 0.2s ease;
    }
    .saved-item:hover {
      background-color: var(--primary-light);
    }
    .saved-item:last-child {
      border-bottom: none;
    }
    .saved-item-header {
      display: flex;
      justify-content: space-between;
      margin-bottom: 0.5rem;
    }
    .saved-item-lang {
      font-weight: 500;
    }
    .saved-item-date {
      font-size: 0.85rem;
      color: var(--text-light);
    }
    .saved-item-text {
      font-size: 0.9rem;
      color: var(--text-light);
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }
    .no-saved {
      text-align: center;
      padding: 2rem;
      color: var(--text-light);
    }
    .no-saved i {
      font-size: 2rem;
      margin-bottom: 1rem;
      opacity: 0.5;
    }
    .top-controls {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 2rem;
    }
    .theme-toggle {
      background: none;
      border: none;
      font-size: 1.5rem;
      color: var(--text-light);
      cursor: pointer;
      transition: all 0.3s ease;
    }
    .theme-toggle:hover {
      color: var(--primary);
      transform: rotate(15deg);
    }
    footer {
      text-align: center;
      margin-top: 3rem;
      padding: 1.5rem;
      color: var(--text-light);
      border-top: 1px solid var(--border);
      font-size: 0.9rem;
    }
    footer p {
      margin-bottom: 1rem;
    }
    .social-links {
      display: flex;
      justify-content: center;
      gap: 1rem;
      margin-top: 1rem;
    }
    .social-link {
      font-size: 1.2rem;
      color: var(--text-light);
      transition: all 0.3s ease;
    }
    .social-link:hover {
      color: var(--primary);
      transform: translateY(-3px);
    }
    
    /* Grammar button and explanation styles */
    .grammar-btn {
      position: absolute;
      bottom: 45px;
      right: 10px;
      border: none;
      background: var(--primary-light);
      cursor: pointer;
      padding: 0.5rem;
      border-radius: 50%;
      transition: all 0.3s ease;
      display: flex;
      align-items: center;
      justify-content: center;
      box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
    }
    
    .grammar-btn:hover {
      background: var(--primary);
    }
    
    .grammar-btn i {
      color: var(--primary-dark);
    }
    
    .grammar-btn:hover i {
      color: white;
    }
    
    .grammar-explanation {
      display: none;
      background: var(--card-bg);
      border-left: 3px solid var(--primary);
      padding: 1rem;
      margin: 1rem 0;
      border-radius: 0.5rem;
      font-size: 0.95rem;
      line-height: 1.6;
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05);
      animation: fadeIn 0.3s ease;
    }
    
    .grammar-explanation.visible {
      display: block;
    }
    
    .grammar-title {
      font-weight: 600;
      margin-bottom: 0.5rem;
      color: var(--primary-dark);
      display: flex;
      align-items: center;
    }
    
    .grammar-title i {
      margin-right: 0.5rem;
    }
    
    .grammar-loading {
      display: flex;
      justify-content: center;
      align-items: center;
      padding: 1rem;
      color: var(--text-light);
    }
    
    .grammar-loading i {
      margin-right: 0.5rem;
    }
    
    .grammar-point {
      margin-bottom: 0.75rem;
      position: relative;
      padding-left: 1.5rem;
    }
    
    .grammar-point:before {
      content: "•";
      position: absolute;
      left: 0.5rem;
      color: var(--primary);
      font-weight: bold;
    }
    
    .grammar-highlight {
      background-color: rgba(91, 104, 255, 0.1);
      color: var(--primary-dark);
      padding: 0 0.3rem;
      border-radius: 0.2rem;
      font-weight: 500;
    }

    /* Romanization styles */
    .romanization {
      font-size: 1rem;
      color: var(--primary);
      margin-bottom: 1rem;
      font-style: italic;
      line-height: 1.8;
    }
    
    @keyframes spin {
      to {
        transform: rotate(360deg);
      }
    }
    @keyframes fadeIn {
      from {
        opacity: 0;
      }
      to {
        opacity: 1;
      }
    }
    @keyframes slideUp {
      from {
        opacity: 0;
        transform: translateY(20px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }
    @keyframes pulse {
      0% {
        opacity: 1;
      }
      50% {
        opacity: 0.8;
      }
      100% {
        opacity: 1;
      }
    }
    @media (max-width: 768px) {
      .container {
        padding: 1rem;
      }
      .logo-text {
        font-size: 2.5rem;
      }
      .tagline {
        font-size: 1.1rem;
      }
      .language-controls {
        flex-direction: column;
        align-items: center;
        gap: 1rem;
      }
      .language-selector {
        width: 100%;
      }
      .output-area {
        padding: 1.5rem;
      }
      .sentence-block {
        padding: 1.5rem 1.5rem 2.5rem 1.5rem;
      }
      .original, .word-mapping {
        font-size: 1.1rem;
      }
      .btn-container {
        flex-direction: column;
      }
      .output-header {
        flex-direction: column;
        gap: 1rem;
      }
      .output-actions {
        justify-content: center;
      }
    }
  </style>
</head>
<body>
  <div class="container">
    <div class="top-controls">
      <button id="theme-toggle" class="theme-toggle" title="Toggle dark mode">
        <i class="fas fa-moon"></i>
      </button>
      <button id="saved-toggle" class="action-btn">
        <i class="fas fa-history"></i> History
      </button>
    </div>
    <header>
      <div class="logo-container">
        <h1 class="logo-text">LinguaLens</h1>
        <span class="logo-badge">Beta</span>
      </div>
      <p class="tagline">Decode foreign languages with the Birkenbihl method and learn more effectively</p>
    </header>
    <div class="info-box">
      <div class="info-icon">
        <i class="fas fa-info-circle"></i>
      </div>
      <div class="info-content">
        <h3>About the Birkenbihl Method</h3>
        <p>The Birkenbihl method helps you learn languages by first understanding exactly what each word means in your native language. This "decoding" phase creates strong neural connections, making language learning more effective and intuitive.</p>
      </div>
    </div>
    <div class="controls-container">
      <div class="language-controls">
        <div class="language-selector">
          <label for="source-lang"><i class="fas fa-globe"></i> Source language:</label>
          <select id="source-lang">
            <option value="fr">French</option>
            <option value="es">Spanish</option>
            <option value="de">German</option>
            <option value="it">Italian</option>
            <option value="ja">Japanese</option>
            <option value="ru">Russian</option>
            <option value="zh">Chinese</option>
            <option value="ar">Arabic</option>
            <option value="pt">Portuguese</option>
            <option value="hi">Hindi</option>
            <option value="ko">Korean</option>
            <option value="tr">Turkish</option>
            <option value="nl">Dutch</option>
            <option value="pl">Polish</option>
            <option value="sv">Swedish</option>
            <option value="vi">Vietnamese</option>
            <option value="th">Thai</option>
            <option value="el">Greek</option>
            <option value="cs">Czech</option>
            <option value="ro">Romanian</option>
            <option value="hu">Hungarian</option>
            <option value="fi">Finnish</option>
            <option value="da">Danish</option>
            <option value="bg">Bulgarian</option>
            <option value="sk">Slovak</option>
            <option value="lt">Lithuanian</option>
            <option value="sl">Slovenian</option>
            <option value="lv">Latvian</option>
            <option value="et">Estonian</option>
            <option value="hr">Croatian</option>
            <option value="sr">Serbian</option>
            <option value="ukr">Ukrainian</option>
            <option value="he">Hebrew</option>
            <option value="id">Indonesian</option>
            <option value="ms">Malay</option>
            <option value="fil">Filipino</option>
            <option value="sw">Swahili</option>
            <option value="af">Afrikaans</option>
            <option value="sq">Albanian</option>
          </select>
        </div>
        <div class="language-selector">
          <label for="target-lang"><i class="fas fa-user"></i> Your language:</label>
          <select id="target-lang">
            <option value="en">English</option>
            <option value="fr">French</option>
            <option value="es">Spanish</option>
            <option value="de">German</option>
            <option value="it">Italian</option>
            <option value="ja">Japanese</option>
            <option value="ru">Russian</option>
            <option value="zh">Chinese</option>
            <option value="ar">Arabic</option>
            <option value="pt">Portuguese</option>
            <option value="hi">Hindi</option>
            <option value="ko">Korean</option>
            <option value="tr">Turkish</option>
            <option value="nl">Dutch</option>
            <option value="pl">Polish</option>
            <option value="sv">Swedish</option>
            <option value="vi">Vietnamese</option>
            <option value="th">Thai</option>
            <option value="el">Greek</option>
            <option value="cs">Czech</option>
            <option value="ro">Romanian</option>
            <option value="hu">Hungarian</option>
            <option value="fi">Finnish</option>
            <option value="da">Danish</option>
            <option value="bg">Bulgarian</option>
            <option value="sk">Slovak</option>
            <option value="lt">Lithuanian</option>
            <option value="sl">Slovenian</option>
            <option value="lv">Latvian</option>
            <option value="et">Estonian</option>
            <option value="hr">Croatian</option>
            <option value="sr">Serbian</option>
            <option value="ukr">Ukrainian</option>
            <option value="he">Hebrew</option>
            <option value="id">Indonesian</option>
            <option value="ms">Malay</option>
            <option value="fil">Filipino</option>
            <option value="sw">Swahili</option>
            <option value="af">Afrikaans</option>
            <option value="sq">Albanian</option>
          </select>
        </div>
      </div>
      
      <div class="quick-actions">
        <button class="action-btn" id="swap-languages">
          <i class="fas fa-exchange-alt"></i> Swap Languages
        </button>
        <button class="action-btn" id="clear-text">
          <i class="fas fa-trash-alt"></i> Clear Text
        </button>
      </div>
      <div class="input-area">
        <div class="textarea-container">
          <textarea id="source-text" placeholder="Paste your text in a foreign language here..."></textarea>
          <div class="character-count">0 / 5000</div>
        </div>
        
        <div class="example-texts">
          <div class="example-text" data-lang="fr">Simple French example</div>
          <div class="example-text" data-lang="es">Simple Spanish example</div>
          <div class="example-text" data-lang="de">Simple German example</div>
          <div class="example-text" data-lang="it">Simple Italian example</div>
          <div class="example-text" data-lang="zh">简单的中文例子</div>
          <div class="example-text" data-lang="ja">簡単な日本語の例</div>
          <div class="example-text" data-lang="ko">간단한 한국어 예시</div>
        </div>
        
        <div class="btn-container">
          <button id="process-btn" class="primary-button">
            <i class="fas fa-magic"></i> Process Text
          </button>
          <button id="save-btn" class="secondary-button">
            <i class="fas fa-bookmark"></i> Save Translation
          </button>
        </div>
      </div>
      <div class="output-area" id="results-container">
        <!-- Results will appear here -->
      </div>
      
      <div class="saved-translations" id="saved-container">
        <h2><i class="fas fa-history"></i> Saved Translations</h2>
        <div class="saved-list" id="saved-list">
          <!-- Saved translations will appear here -->
          <div class="no-saved">
            <i class="fas fa-folder-open"></i>
            <p>No saved translations yet</p>
          </div>
        </div>
      </div>
    </div>
  </div>
  <footer>
    <p>LinguaLens - Learn languages effectively with the Birkenbihl method</p>
    <p>© 2023 LinguaLens</p>
  </footer>

  <script>
    document.addEventListener('DOMContentLoaded', function() {
      // DOM elements
      const themeToggle = document.getElementById('theme-toggle');
      const savedToggle = document.getElementById('saved-toggle');
      const sourceLang = document.getElementById('source-lang');
      const targetLang = document.getElementById('target-lang');
      const swapLangsBtn = document.getElementById('swap-languages');
      const clearTextBtn = document.getElementById('clear-text');
      const sourceText = document.getElementById('source-text');
      const charCount = document.querySelector('.character-count');
      const exampleTexts = document.querySelectorAll('.example-text');
      const processBtn = document.getElementById('process-btn');
      const saveBtn = document.getElementById('save-btn');
      const resultsContainer = document.getElementById('results-container');
      const savedContainer = document.getElementById('saved-container');
      const savedList = document.getElementById('saved-list');
      
      // Examples for different languages
      const examples = {
        'fr': 'Je voudrais un café, s\'il vous plaît. Merci beaucoup!',
        'es': 'Me gustaría tomar un café, por favor. ¡Muchas gracias!',
        'de': 'Ich hätte gerne einen Kaffee, bitte. Vielen Dank!',
        'it': 'Vorrei un caffè, per favore. Grazie mille!',
        'zh': '我想要一杯咖啡，谢谢。非常感谢！',
        'ja': 'コーヒーをお願いします。どうもありがとうございます！',
        'ko': '커피 한 잔 주세요. 정말 감사합니다!',
        'ru': 'Я бы хотел кофе, пожалуйста. Большое спасибо!'
      };
      
      // Theme toggle functionality
      themeToggle.addEventListener('click', function() {
        document.body.classList.toggle('dark-mode');
        
        if (document.body.classList.contains('dark-mode')) {
          themeToggle.querySelector('i').className = 'fas fa-sun';
        } else {
          themeToggle.querySelector('i').className = 'fas fa-moon';
        }
        
        // Save preference to localStorage
        localStorage.setItem('darkMode', document.body.classList.contains('dark-mode'));
      });
      
      // Load theme preference
      if (localStorage.getItem('darkMode') === 'true') {
        document.body.classList.add('dark-mode');
        themeToggle.querySelector('i').className = 'fas fa-sun';
      }
      
      // Saved translations toggle
      savedToggle.addEventListener('click', function() {
        savedContainer.classList.toggle('visible');
        loadSavedTranslations();
      });
      
      // Swap languages
      swapLangsBtn.addEventListener('click', function() {
        const sourceVal = sourceLang.value;
        const targetVal = targetLang.value;
        
        if (targetVal !== 'en') { // Can only swap if target is not English
          sourceLang.value = targetVal;
          targetLang.value = sourceVal;
        }
      });
      
      // Clear text
      clearTextBtn.addEventListener('click', function() {
        sourceText.value = '';
        updateCharCount();
      });
      
      // Character count update
      sourceText.addEventListener('input', updateCharCount);
      
      function updateCharCount() {
        const count = sourceText.value.length;
        charCount.textContent = `${count} / 5000`;
        
        if (count > 5000) {
          charCount.style.color = 'var(--danger)';
        } else {
          charCount.style.color = 'var(--text-light)';
        }
      }
      
      // Example texts functionality
      exampleTexts.forEach(example => {
        example.addEventListener('click', function() {
          const lang = this.dataset.lang;
          if (examples[lang]) {
            sourceLang.value = lang;
            sourceText.value = examples[lang];
            updateCharCount();
          }
        });
      });
      
      // Process button
      processBtn.addEventListener('click', function() {
        processText();
      });
      
      // Save translation
      saveBtn.addEventListener('click', function() {
        saveTranslation();
      });
      
      // Process text function
      async function processText() {
        const text = sourceText.value.trim();
        if (!text) {
          showError('Please enter some text to process');
          return;
        }
        
        if (text.length > 5000) {
          showError('Text exceeds maximum length of 5000 characters');
          return;
        }
        
        // Show loading state
        showLoading();
        
        try {
          const response = await fetch('/process', {
            method: 'POST',
            headers: {
              'Content-Type': 'application/json'
            },
            body: JSON.stringify({
              text: text,
              sourceLang: sourceLang.value,
              targetLang: targetLang.value
            })
          });
          
          if (!response.ok) {
            throw new Error('Server error');
          }
          
          const reader = response.body.getReader();
          const decoder = new TextDecoder();
          
          resultsContainer.innerHTML = '';
          resultsContainer.classList.add('visible');
          
          // Create output header
          const outputHeader = document.createElement('div');
          outputHeader.className = 'output-header';
          
          const outputTitle = document.createElement('div');
          outputTitle.className = 'output-title';
          outputTitle.textContent = 'Translation Results';
          
          const outputActions = document.createElement('div');
          outputActions.className = 'output-actions';
          
          const copyAction = document.createElement('button');
          copyAction.className = 'output-action';
          copyAction.innerHTML = '<i class="fas fa-copy"></i> Copy';
          copyAction.addEventListener('click', () => copyResults());
          
          const speakAllAction = document.createElement('button');
          speakAllAction.className = 'output-action';
          speakAllAction.innerHTML = '<i class="fas fa-volume-up"></i> Speak All';
          speakAllAction.addEventListener('click', () => speakAllText());
          
          outputActions.appendChild(copyAction);
          outputActions.appendChild(speakAllAction);
          
          outputHeader.appendChild(outputTitle);
          outputHeader.appendChild(outputActions);
          
          resultsContainer.appendChild(outputHeader);
          
          let index = 0;
          let sentences = [];
          
          while (true) {
            const { value, done } = await reader.read();
            
            if (done) {
              break;
            }
            
            const chunk = decoder.decode(value);
            const lines = chunk.split('\n');
            
            for (const line of lines) {
              if (line.trim()) {
                try {
                  const sentenceData = JSON.parse(line);
                  sentences.push(sentenceData);
                  
                  const sentenceBlock = createSentenceBlock(sentenceData, index);
                  resultsContainer.appendChild(sentenceBlock);
                  index++;
                  
                  // Update the loading state to show progress
                  updateLoadingProgress(`Processed ${index} sentences...`);
                } catch (e) {
                  console.error('Error parsing sentence data:', e);
                }
              }
            }
          }
          
          // Hide loading when complete
          hideLoading();
          
        } catch (error) {
          console.error('Error processing text:', error);
          showError('An error occurred while processing your text. Please try again.');
          hideLoading();
        }
      }
      
      // Function to create a sentence block with romanization support
      function createSentenceBlock(data, index) {
        const sentenceBlock = document.createElement('div');
        sentenceBlock.className = 'sentence-block';
        
        // Create sentence header
        const sentenceHeader = document.createElement('div');
        sentenceHeader.className = 'sentence-header';
        
        const sentenceNumber = document.createElement('div');
        sentenceNumber.className = 'sentence-number';
        sentenceNumber.textContent = `Sentence ${index + 1}`;
        
        sentenceHeader.appendChild(sentenceNumber);
        sentenceBlock.appendChild(sentenceHeader);
        
        // Original text
        const original = document.createElement('div');
        original.className = 'original';
        original.textContent = data.original;
        sentenceBlock.appendChild(original);
        
        // Romanization (if available) - NEW FEATURE
        if (data.romanization) {
          const romanization = document.createElement('div');
          romanization.className = 'romanization';
          romanization.textContent = data.romanization;
          sentenceBlock.appendChild(romanization);
        }
        
        // Word by word translation
        const wordMapping = document.createElement('div');
        wordMapping.className = 'word-mapping';
        wordMapping.textContent = data.wordByWord;
        sentenceBlock.appendChild(wordMapping);
        
        // Fluent translation
        const translation = document.createElement('div');
        translation.className = 'translation';
        translation.textContent = data.fluentTranslation;
        sentenceBlock.appendChild(translation);
        
        // Interactive words with translations
        const words = document.createElement('div');
        words.className = 'words-container';
        
        // Create word elements with tooltips
        const originalWords = data.original.split(/\s+/);
        for (const word of originalWords) {
          if (word.trim()) {
            const wordElement = document.createElement('span');
            wordElement.className = 'word';
            wordElement.textContent = word;
            
            if (data.wordTranslations[word]) {
              const tooltip = document.createElement('span');
              tooltip.className = 'tooltip';
              tooltip.textContent = data.wordTranslations[word];
              wordElement.appendChild(tooltip);
            }
            
            words.appendChild(wordElement);
            words.appendChild(document.createTextNode(' '));
          }
        }
        
        sentenceBlock.appendChild(words);
        
        // Add grammar explanation button
        const grammarBtn = document.createElement('button');
        grammarBtn.className = 'grammar-btn';
        grammarBtn.innerHTML = '<i class="fas fa-book"></i>';
        grammarBtn.title = 'Show grammar explanation';
        grammarBtn.addEventListener('click', () => {
          // Get grammar explanation
          const grammarContainer = sentenceBlock.querySelector('.grammar-explanation') || 
                                  createGrammarContainer(sentenceBlock);
          
          if (grammarContainer.classList.contains('visible')) {
            grammarContainer.classList.remove('visible');
          } else {
            getGrammarExplanation(data.original, sourceLang.value, targetLang.value, grammarContainer);
            grammarContainer.classList.add('visible');
          }
        });
        
        // Add text-to-speech button
        const speakBtn = document.createElement('button');
        speakBtn.className = 'speak-btn';
        speakBtn.innerHTML = '<i class="fas fa-volume-up"></i>';
        speakBtn.title = 'Listen to pronunciation';
        speakBtn.addEventListener('click', () => {
          speakText(data.original, sourceLang.value);
        });
        
        sentenceBlock.appendChild(grammarBtn);
        sentenceBlock.appendChild(speakBtn);
        
        return sentenceBlock;
      }
      
      // Function to create grammar explanation container
      function createGrammarContainer(sentenceBlock) {
        const grammarContainer = document.createElement('div');
        grammarContainer.className = 'grammar-explanation';
        
        const grammarTitle = document.createElement('div');
        grammarTitle.className = 'grammar-title';
        grammarTitle.innerHTML = '<i class="fas fa-book"></i> Grammar Explanation';
        
        const grammarLoading = document.createElement('div');
        grammarLoading.className = 'grammar-loading';
        grammarLoading.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Loading grammar explanation...';
        
        grammarContainer.appendChild(grammarTitle);
        grammarContainer.appendChild(grammarLoading);
        sentenceBlock.appendChild(grammarContainer);
        
        return grammarContainer;
      }
      
      // Function to get grammar explanation
      async function getGrammarExplanation(sentence, sourceLang, targetLang, container) {
        const loadingElement = container.querySelector('.grammar-loading');
        loadingElement.style.display = 'flex';
        
        try {
          const response = await fetch('/grammar-explanation', {
            method: 'POST',
            headers: {
              'Content-Type': 'application/json'
            },
            body: JSON.stringify({
              sentence: sentence,
              sourceLang: sourceLang,
              targetLang: targetLang
            })
          });
          
          if (!response.ok) {
            throw new Error('Server error');
          }
          
          const data = await response.json();
          
          // Remove loading element
          loadingElement.style.display = 'none';
          
          // Remove any existing points
          const existingPoints = container.querySelectorAll('.grammar-point');
          existingPoints.forEach(point => point.remove());
          
          // Add grammar points
          if (data.points && data.points.length > 0) {
            data.points.forEach(point => {
              const pointElement = document.createElement('div');
              pointElement.className = 'grammar-point';
              
              // Replace **text** with highlighted span
              const highlightedText = point.replace(/\*\*(.*?)\*\*/g, '<span class="grammar-highlight">$1</span>');
              pointElement.innerHTML = highlightedText;
              
              container.appendChild(pointElement);
            });
          } else {
            const noPoints = document.createElement('div');
            noPoints.className = 'grammar-point';
            noPoints.textContent = 'No grammar points available for this sentence.';
            container.appendChild(noPoints);
          }
          
        } catch (error) {
          console.error('Error fetching grammar explanation:', error);
          loadingElement.innerHTML = '<i class="fas fa-exclamation-circle"></i> Failed to load grammar explanation';
        }
      }
      
      // Function to speak text using Web Speech API
      function speakText(text, language) {
        if ('speechSynthesis' in window) {
          // Map language codes to speech synthesis voices
          const langMap = {
            'en': 'en-US',
            'fr': 'fr-FR',
            'es': 'es-ES',
            'de': 'de-DE',
            'it': 'it-IT',
            'ja': 'ja-JP',
            'ru': 'ru-RU',
            'zh': 'zh-CN',
            'ko': 'ko-KR'
          };
          
          const utterance = new SpeechSynthesisUtterance(text);
          utterance.lang = langMap[language] || language;
          
          speechSynthesis.speak(utterance);
        } else {
          alert('Text-to-speech is not supported in your browser.');
        }
      }
      
      // Function to speak all text in results
      function speakAllText() {
        const originals = resultsContainer.querySelectorAll('.original');
        
        if (originals.length === 0) {
          return;
        }
        
        // Cancel any current speech
        if ('speechSynthesis' in window) {
          speechSynthesis.cancel();
        }
        
        // Speak each sentence with a delay
        originals.forEach((original, index) => {
          setTimeout(() => {
            speakText(original.textContent, sourceLang.value);
          }, index * 3000); // 3 second delay between sentences
        });
      }
      
      // Function to copy all results
      function copyResults() {
        const originals = resultsContainer.querySelectorAll('.original');
        const translations = resultsContainer.querySelectorAll('.translation');
        
        if (originals.length === 0) {
          return;
        }
        
        let copyText = '';
        for (let i = 0; i < originals.length; i++) {
          copyText += originals[i].textContent + '\n';
          copyText += translations[i].textContent + '\n\n';
        }
        
        navigator.clipboard.writeText(copyText).then(() => {
          alert('Translation copied to clipboard!');
        });
      }
      
      // Function to save translation
      function saveTranslation() {
        const text = sourceText.value.trim();
        if (!text) {
          return;
        }
        
        const translations = JSON.parse(localStorage.getItem('savedTranslations') || '[]');
        
        translations.push({
          text: text.substring(0, 50) + (text.length > 50 ? '...' : ''),
          fullText: text,
          sourceLang: sourceLang.value,
          targetLang: targetLang.value,
          date: new Date().toISOString()
        });
        
        // Keep only the latest 20 translations
        if (translations.length > 20) {
          translations.shift();
        }
        
        localStorage.setItem('savedTranslations', JSON.stringify(translations));
        loadSavedTranslations();
        
        // Show feedback
        alert('Translation saved!');
      }
      
      // Function to load saved translations
      function loadSavedTranslations() {
        const translations = JSON.parse(localStorage.getItem('savedTranslations') || '[]');
        
        if (translations.length === 0) {
          savedList.innerHTML = `
            <div class="no-saved">
              <i class="fas fa-folder-open"></i>
              <p>No saved translations yet</p>
            </div>
          `;
          return;
        }
        
        savedList.innerHTML = '';
        
        // Sort by date (newest first)
        translations.sort((a, b) => new Date(b.date) - new Date(a.date));
        
        for (const translation of translations) {
          const item = document.createElement('div');
          item.className = 'saved-item';
          
          const header = document.createElement('div');
          header.className = 'saved-item-header';
          
          const lang = document.createElement('div');
          lang.className = 'saved-item-lang';
          lang.textContent = `${getLangName(translation.sourceLang)} → ${getLangName(translation.targetLang)}`;
          
          const date = document.createElement('div');
          date.className = 'saved-item-date';
          date.textContent = formatDate(translation.date);
          
          header.appendChild(lang);
          header.appendChild(date);
          
          const text = document.createElement('div');
          text.className = 'saved-item-text';
          text.textContent = translation.text;
          
          item.appendChild(header);
          item.appendChild(text);
          
          // Load saved translation when clicked
          item.addEventListener('click', () => {
            sourceText.value = translation.fullText;
            sourceLang.value = translation.sourceLang;
            targetLang.value = translation.targetLang;
            updateCharCount();
            savedContainer.classList.remove('visible');
            window.scrollTo(0, sourceText.offsetTop - 100);
          });
          
          savedList.appendChild(item);
        }
      }
      
      // Helper function to format date
      function formatDate(dateStr) {
        const date = new Date(dateStr);
        return date.toLocaleDateString() + ' ' + date.toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' });
      }
      
      // Helper function to get language name
      function getLangName(code) {
        const languages = {
          'en': 'English', 'fr': 'French', 'es': 'Spanish', 'de': 'German',
          'it': 'Italian', 'ja': 'Japanese', 'ru': 'Russian', 'zh': 'Chinese',
          'ar': 'Arabic', 'pt': 'Portuguese', 'hi': 'Hindi', 'ko': 'Korean'
        };
        return languages[code] || code;
      }
      
      // Function to show loading UI
      function showLoading() {
        resultsContainer.innerHTML = `
          <div class="loading">
            <div class="spinner"></div>
            <div class="loading-text">Processing your text...</div>
            <div class="processing-steps">
              <div class="processing-step" id="step-parsing">
                <i class="fas fa-circle-notch fa-spin"></i> Analyzing text structure
              </div>
              <div class="processing-step" id="step-translating">
                <i class="fas fa-circle-notch fa-spin"></i> Creating word-by-word translation
              </div>
              <div class="processing-step" id="step-fluent">
                <i class="fas fa-circle-notch fa-spin"></i> Generating fluent translation
              </div>
            </div>
          </div>
        `;
        resultsContainer.classList.add('visible');
        
        // Simulate progress for better UX
        setTimeout(() => {
          document.getElementById('step-parsing').classList.add('completed');
          document.getElementById('step-parsing').innerHTML = '<i class="fas fa-check-circle"></i> Analyzing text structure';
        }, 800);
        
        setTimeout(() => {
          document.getElementById('step-translating').classList.add('completed');
          document.getElementById('step-translating').innerHTML = '<i class="fas fa-check-circle"></i> Creating word-by-word translation';
        }, 2000);
      }
      
      // Function to hide loading UI
      function hideLoading() {
        const loadingElement = resultsContainer.querySelector('.loading');
        if (loadingElement) {
          loadingElement.remove();
        }
      }
      
      // Function to update loading progress
      function updateLoadingProgress(message) {
        const loadingText = resultsContainer.querySelector('.loading-text');
        if (loadingText) {
          loadingText.textContent = message;
        }
        
        // Mark the fluent step as completed
        const fluentStep = document.getElementById('step-fluent');
        if (fluentStep) {
          fluentStep.classList.add('completed');
          fluentStep.innerHTML = '<i class="fas fa-check-circle"></i> Generating fluent translation';
        }
      }
      
      // Function to show error
      function showError(message) {
        resultsContainer.innerHTML = `
          <div class="error">
            <i class="fas fa-exclamation-circle"></i>
            <h3>Error</h3>
            <p>${message}</p>
            <button class="retry-btn">
              <i class="fas fa-redo"></i> Try Again
            </button>
          </div>
        `;
        resultsContainer.classList.add('visible');
        
        // Add event listener to retry button
        const retryBtn = resultsContainer.querySelector('.retry-btn');
        retryBtn.addEventListener('click', () => {
          processText();
        });
      }
      
      // Initialize character count
      updateCharCount();
    });
  </script>
</body>
</html>
