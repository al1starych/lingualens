<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>LinguaLens | Learn Languages with Birkenbihl Method</title>
  <meta name="description" content="LinguaLens helps you learn foreign languages more effectively using the Birkenbihl method - decoding languages word by word">
  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  <link
    href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap"
    rel="stylesheet"
  />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
  <style>
    :root {
      --primary: #5b68ff;
      --primary-dark: #4355f0;
      --primary-light: #e8ebff;
      --secondary: #ff6b6b;
      --secondary-dark: #ff5252;
      --text: #2a2f45;
      --text-light: #6c757d;
      --bg: #fcfdff;
      --card-bg: #ffffff;
      --border: #e4e8f0;
      --success: #28a745;
      --info: #17a2b8;
      --warning: #ffc107;
      --danger: #dc3545;
    }
    .dark-mode {
      --primary: #7c86ff;
      --primary-dark: #6169ff;
      --primary-light: #282f60;
      --secondary: #ff8585;
      --secondary-dark: #ff6969;
      --text: #f1f3f5;
      --text-light: #adb5bd;
      --bg: #121826;
      --card-bg: #1e293b;
      --border: #2c3a52;
    }
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }
    body {
      font-family: "Inter", sans-serif;
      background-color: var(--bg);
      color: var(--text);
      line-height: 1.6;
      transition: all 0.3s ease;
    }
    .container {
      max-width: 1140px;
      margin: 0 auto;
      padding: 2rem;
    }
    header {
      text-align: center;
      margin-bottom: 3rem;
      animation: fadeIn 0.8s ease;
    }
    .logo-container {
      margin-bottom: 1rem;
      display: inline-block;
      position: relative;
    }
    .logo-text {
      font-size: 3.5rem;
      font-weight: 800;
      background: linear-gradient(90deg, var(--primary), var(--secondary));
      -webkit-background-clip: text;
      background-clip: text;
      color: transparent;
      margin-bottom: 0.5rem;
      animation: pulse 5s infinite alternate;
    }
    .logo-badge {
      position: absolute;
      top: -5px;
      right: -40px;
      background: var(--secondary);
      color: white;
      font-size: 0.8rem;
      padding: 0.2rem 0.5rem;
      border-radius: 20px;
      font-weight: 600;
      transform: rotate(15deg);
      box-shadow: 0 3px 6px rgba(0, 0, 0, 0.1);
      visibility: hidden;
    }
    .tagline {
      font-size: 1.3rem;
      color: var(--text-light);
      max-width: 600px;
      margin: 0 auto;
      line-height: 1.5;
    }
    .info-box {
      background: var(--primary-light);
      border-radius: 0.75rem;
      padding: 1.5rem;
      margin-bottom: 2rem;
      display: flex;
      align-items: flex-start;
      animation: slideUp 0.8s ease;
      box-shadow: 0 4px 6px rgba(91, 104, 255, 0.1);
    }
    .info-icon {
      margin-right: 1rem;
      font-size: 1.5rem;
      color: var(--primary);
    }
    .info-content h3 {
      margin-bottom: 0.5rem;
      font-weight: 600;
      color: var(--primary-dark);
    }
    .info-content p {
      color: var(--text);
      font-size: 0.95rem;
    }
    .controls-container {
      display: flex;
      flex-direction: column;
      gap: 2rem;
      margin-bottom: 2rem;
      animation: slideUp 0.6s ease;
    }
    .language-controls {
      display: flex;
      justify-content: center;
      gap: 2rem;
      margin-bottom: 1rem;
      flex-wrap: wrap;
    }
    .language-selector {
      display: flex;
      flex-direction: column;
      min-width: 200px;
    }
    .language-selector label {
      margin-bottom: 0.5rem;
      font-weight: 500;
      display: flex;
      align-items: center;
    }
    .language-selector label i {
      margin-right: 0.5rem;
      color: var(--primary);
    }
    .quick-actions {
      display: flex;
      justify-content: center;
      gap: 1rem;
      margin-bottom: 1rem;
    }
    .action-btn {
      padding: 0.5rem 1rem;
      background: var(--primary-light);
      color: var(--primary);
      border: none;
      border-radius: 0.5rem;
      font-size: 0.9rem;
      font-weight: 500;
      cursor: pointer;
      transition: all 0.3s ease;
      display: flex;
      align-items: center;
    }
    .action-btn i {
      margin-right: 0.5rem;
    }
    .action-btn:hover {
      background: var(--primary);
      color: white;
    }
    select {
      padding: 0.85rem 1.2rem;
      border-radius: 0.75rem;
      border: 1px solid var(--border);
      font-size: 1rem;
      background-color: var(--card-bg);
      box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
      transition: all 0.3s ease;
      color: var(--text);
      -webkit-appearance: none;
      -moz-appearance: none;
      appearance: none;
      background-repeat: no-repeat;
      background-position: right 1rem top 50%;
      background-size: 0.65rem auto;
      padding-right: 2.5rem;
    }
    select:focus {
      outline: none;
      border-color: var(--primary);
      box-shadow: 0 0 0 3px rgba(91, 104, 255, 0.2);
    }
    .input-area {
      margin-bottom: 2rem;
      animation: slideUp 0.6s ease;
    }
    .textarea-container {
      position: relative;
      margin-bottom: 1rem;
    }
    textarea {
      width: 100%;
      height: 150px;
      padding: 1.25rem;
      border-radius: 0.75rem;
      border: 1px solid var(--border);
      font-family: inherit;
      font-size: 1rem;
      resize: vertical;
      transition: all 0.3s ease;
      box-shadow: 0 4px 6px rgba(0, 0, 0, 0.05);
      color: var(--text);
      background-color: var(--card-bg);
    }
    textarea:focus {
      outline: none;
      border-color: var(--primary);
      box-shadow: 0 0 0 3px rgba(91, 104, 255, 0.2);
    }
    .character-count {
      position: absolute;
      bottom: 0.5rem;
      right: 0.5rem;
      font-size: 0.8rem;
      color: var(--text-light);
      pointer-events: none;
    }
    .example-texts {
      display: flex;
      flex-wrap: wrap;
      gap: 0.5rem;
      margin-bottom: 1rem;
    }
    .example-text {
      font-size: 0.85rem;
      padding: 0.4rem 0.75rem;
      background: var(--primary-light);
      color: var(--primary);
      border-radius: 0.5rem;
      cursor: pointer;
      transition: all 0.2s ease;
    }
    .example-text:hover {
      background: var(--primary);
      color: white;
    }
    .btn-container {
      display: flex;
      justify-content: center;
      gap: 1rem;
    }
    button.primary-button {
      display: inline-flex;
      align-items: center;
      justify-content: center;
      padding: 0.85rem 2.5rem;
      border: none;
      border-radius: 0.5rem;
      background: linear-gradient(90deg, var(--primary), #7664ff);
      color: white;
      font-family: inherit;
      font-size: 1rem;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s ease;
      box-shadow: 0 4px 10px rgba(91, 104, 255, 0.3);
    }
    button.primary-button i {
      margin-right: 0.5rem;
    }
    button.primary-button:hover {
      transform: translateY(-2px);
      box-shadow: 0 6px 15px rgba(91, 104, 255, 0.4);
    }
    button.primary-button:active {
      transform: translateY(0);
    }
    button.secondary-button {
      display: inline-flex;
      align-items: center;
      justify-content: center;
      padding: 0.85rem 2rem;
      border: 1px solid var(--border);
      border-radius: 0.5rem;
      background: var(--card-bg);
      color: var(--text);
      font-family: inherit;
      font-size: 1rem;
      font-weight: 500;
      cursor: pointer;
      transition: all 0.3s ease;
    }
    button.secondary-button i {
      margin-right: 0.5rem;
    }
    button.secondary-button:hover {
      background: var(--primary-light);
      color: var(--primary);
      border-color: var(--primary-light);
    }
    .output-area {
      background-color: var(--card-bg);
      border-radius: 1rem;
      box-shadow: 0 8px 20px rgba(0, 0, 0, 0.08);
      padding: 2rem;
      margin-top: 2rem;
      opacity: 0;
      transform: translateY(20px);
      transition: all 0.5s ease;
    }
    .output-area.visible {
      opacity: 1;
      transform: translateY(0);
    }
    .output-header {
      display: flex;
      justify-content: space-between;
      margin-bottom: 1.5rem;
      padding-bottom: 1rem;
      border-bottom: 1px solid var(--border);
    }
    .output-title {
      font-size: 1.25rem;
      font-weight: 600;
      color: var(--text);
    }
    .output-actions {
      display: flex;
      gap: 1rem;
    }
    .output-action {
      background: none;
      border: none;
      color: var(--primary);
      font-size: 1rem;
      cursor: pointer;
      transition: all 0.2s ease;
      display: flex;
      align-items: center;
    }
    .output-action i {
      margin-right: 0.3rem;
    }
    .output-action:hover {
      color: var(--primary-dark);
    }
    .sentence-block {
      margin-bottom: 2rem;
      padding: 2rem 2rem 2.5rem 2rem;
      border-bottom: 1px solid var(--border);
      position: relative;
      transition: all 0.3s ease;
    }
    .sentence-block:hover {
      background-color: var(--primary-light);
      border-radius: 0.5rem;
    }
    .sentence-block:last-child {
      margin-bottom: 0;
      padding-bottom: 0;
      border-bottom: none;
    }
    .sentence-header {
      display: flex;
      justify-content: space-between;
      margin-bottom: 1rem;
    }
    .sentence-number {
      font-size: 0.9rem;
      font-weight: 500;
      color: var(--text-light);
    }
.original {
  font-size: 1.35rem;
  margin-bottom: 1rem;
  line-height: 1.8;
  font-weight: 500;
  transition: opacity 0.3s ease, display 0.3s ease; /* Add transition for smooth hiding/showing */
}

.original[style*="display: none"] {
  opacity: 0; /* Ensure it fades out when hidden */
}

.original[style*="display: block"] {
  opacity: 1; /* Ensure it fades in when shown */
}
    .word-mapping {
      font-size: 1.1rem;
      margin-bottom: 1rem;
      color: var(--primary);
      line-height: 1.8;
    }
    .translation {
      font-size: 1rem;
      color: var(--text-light);
      font-style: italic;
      margin-bottom: 1rem;
    }
    .word {
      display: inline-block;
      position: relative;
      cursor: pointer;
      transition: all 0.2s ease;
      padding: 0 0.1rem;
      border-radius: 0.2rem;
    }
    .word:hover {
      color: var(--secondary);
      background-color: rgba(255, 107, 107, 0.1);
    }
    .tooltip {
      position: absolute;
      bottom: 100%;
      left: 50%;
      transform: translateX(-50%);
      background-color: var(--primary-light);
      color: var(--primary);
      padding: 0.5rem 1rem;
      border-radius: 0.5rem;
      font-size: 0.9rem;
      white-space: nowrap;
      opacity: 0;
      pointer-events: none;
      transition: opacity 0.3s ease;
      box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
      z-index: 10;
    }
    .word:hover .tooltip {
      opacity: 1;
    }
    .sentence-actions {
      display: flex;
      gap: 1rem;
      margin-top: 1rem;
    }
    .sentence-action {
      display: flex;
      align-items: center;
      background: none;
      border: none;
      color: var(--text-light);
      font-size: 0.9rem;
      cursor: pointer;
      transition: all 0.2s ease;
    }
    .sentence-action i {
      margin-right: 0.3rem;
    }
    .sentence-action:hover {
      color: var(--primary);
    }
    /* Per-sentence speak button positioned at bottom right */
    .speak-btn {
      position: absolute;
      bottom: 10px;
      right: 10px;
      border: none;
      background: var(--primary-light);
      cursor: pointer;
      padding: 0.5rem;
      border-radius: 50%;
      transition: all 0.3s ease;
      display: flex;
      align-items: center;
      justify-content: center;
      box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
    }
    .speak-btn:hover {
      background: var(--primary);
    }

    .speak-btn i {
      color: var(--primary);
    }

    .speak-btn:hover i {
      color: #fff;
    }
    
    .speak-btn img {
      width: 20px;
      height: 20px;
    }
    .loading {
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      min-height: 200px;
      gap: 1rem;
    }
    .spinner {
      width: 40px;
      height: 40px;
      border: 4px solid rgba(91, 104, 255, 0.2);
      border-left-color: var(--primary);
      border-radius: 50%;
      animation: spin 1s linear infinite;
    }
    .loading-text {
      color: var(--text-light);
      font-size: 0.9rem;
    }
    .processing-steps {
      margin-top: 1rem;
      font-size: 0.85rem;
      color: var(--text-light);
    }
    .processing-step {
      display: flex;
      align-items: center;
      margin-bottom: 0.4rem;
    }
    .processing-step.completed {
      color: var(--success);
    }
    .processing-step i {
      margin-right: 0.4rem;
    }
    .error {
      color: var(--danger);
      text-align: center;
      padding: 2rem;
      background-color: rgba(220, 53, 69, 0.1);
      border-radius: 0.5rem;
    }
    .error i {
      font-size: 2rem;
      margin-bottom: 1rem;
    }
    .error h3 {
      margin-bottom: 0.5rem;
    }
    .error p {
      margin-bottom: 1rem;
    }
    .retry-btn {
      display: inline-flex;
      align-items: center;
      justify-content: center;
      padding: 0.5rem 1rem;
      background: var(--danger);
      color: white;
      border: none;
      border-radius: 0.5rem;
      font-size: 0.9rem;
      font-weight: 500;
      cursor: pointer;
      transition: all 0.3s ease;
    }
    .retry-btn i {
      margin-right: 0.5rem;
      font-size: 0.9rem;
    }
    .retry-btn:hover {
      background: #c82333;
    }
    .saved-translations {
      background: var(--card-bg);
      border-radius: 1rem;
      margin-top: 2rem;
      padding: 1.5rem;
      animation: fadeIn 0.8s ease;
      box-shadow: 0 4px 10px rgba(0, 0, 0, 0.05);
      display: none;
    }
    .saved-translations.visible {
      display: block;
    }
    .saved-translations h2 {
      font-size: 1.25rem;
      margin-bottom: 1rem;
      display: flex;
      align-items: center;
    }
    .saved-translations h2 i {
      margin-right: 0.5rem;
      color: var(--primary);
    }
    .saved-list {
      max-height: 300px;
      overflow-y: auto;
    }
    .saved-item {
      padding: 1rem;
      border-bottom: 1px solid var(--border);
      cursor: pointer;
      transition: all 0.2s ease;
    }
    .saved-item:hover {
      background-color: var(--primary-light);
    }
    .saved-item:last-child {
      border-bottom: none;
    }
    .saved-item-header {
      display: flex;
      justify-content: space-between;
      margin-bottom: 0.5rem;
    }
    .saved-item-lang {
      font-weight: 500;
    }
    .saved-item-date {
      font-size: 0.85rem;
      color: var(--text-light);
    }
    .saved-item-text {
      font-size: 0.9rem;
      color: var(--text-light);
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }
    .no-saved {
      text-align: center;
      padding: 2rem;
      color: var(--text-light);
    }
    .no-saved i {
      font-size: 2rem;
      margin-bottom: 1rem;
      opacity: 0.5;
    }
    .top-controls {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 2rem;
    }
    .theme-toggle {
      background: none;
      border: none;
      font-size: 1.5rem;
      color: var(--text-light);
      cursor: pointer;
      transition: all 0.3s ease;
    }
    .theme-toggle:hover {
      color: var(--primary);
      transform: rotate(15deg);
    }
    footer {
      text-align: center;
      margin-top: 3rem;
      padding: 1.5rem;
      color: var(--text-light);
      border-top: 1px solid var(--border);
      font-size: 0.9rem;
    }
    footer p {
      margin-bottom: 1rem;
    }
    .social-links {
      display: flex;
      justify-content: center;
      gap: 1rem;
      margin-top: 1rem;
    }
    .social-link {
      font-size: 1.2rem;
      color: var(--text-light);
      transition: all 0.3s ease;
    }
    .social-link:hover {
      color: var(--primary);
      transform: translateY(-3px);
    }
    
    /* Grammar button and explanation styles */
    .grammar-btn {
      position: absolute;
      bottom: 45px;
      right: 10px;
      border: none;
      background: var(--primary-light);
      cursor: pointer;
      padding: 0.5rem;
      border-radius: 50%;
      transition: all 0.3s ease;
      display: flex;
      align-items: center;
      justify-content: center;
      box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
    }
    
    .grammar-btn:hover {
      background: var(--primary);
    }
    
    .grammar-btn i {
      color: var(--primary-dark);
    }
    
    .grammar-btn:hover i {
      color: white;
    }
    
    .grammar-explanation {
      display: none;
      background: var(--card-bg);
      border-left: 3px solid var(--primary);
      padding: 1rem;
      margin: 1rem 0;
      border-radius: 0.5rem;
      font-size: 0.95rem;
      line-height: 1.6;
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05);
      animation: fadeIn 0.3s ease;
    }
    
    .grammar-explanation.visible {
      display: block;
    }
    
    .grammar-title {
      font-weight: 600;
      margin-bottom: 0.5rem;
      color: var(--primary-dark);
      display: flex;
      align-items: center;
    }
    
    .grammar-title i {
      margin-right: 0.5rem;
    }
    
    .grammar-loading {
      display: flex;
      justify-content: center;
      align-items: center;
      padding: 1rem;
      color: var(--text-light);
    }
    
    .grammar-loading i {
      margin-right: 0.5rem;
    }
    
    .grammar-point {
      margin-bottom: 0.75rem;
      position: relative;
      padding-left: 1.5rem;
    }
    
    .grammar-point:before {
      content: "•";
      position: absolute;
      left: 0.5rem;
      color: var(--primary);
      font-weight: bold;
    }
    
    .grammar-highlight {
      background-color: rgba(91, 104, 255, 0.1);
      color: var(--primary-dark);
      padding: 0 0.3rem;
      border-radius: 0.2rem;
      font-weight: 500;
    }

    /* Romanization styles */
    .romanization {
      font-size: 1rem;
      color: var(--primary);
      margin-bottom: 1rem;
      font-style: italic;
      line-height: 1.8;
    }
    
    /* NEW STYLES FOR ALIGNED WORD-BY-WORD TRANSLATION */
    .aligned-translation {
      display: flex;
      flex-wrap: wrap;
      margin-bottom: 1.5rem;
      gap: 0.5rem 1rem;
    }
    
    .word-pair {
      display: flex;
      flex-direction: column;
      align-items: center;
      text-align: center;
      margin-bottom: 0.5rem;
    }
    
    .original-word {
      font-weight: 600;
      font-size: 1.2rem;
      color: #5c15d7;
      min-width: 40px;
    }
    
    .translation-word {
      font-size: 0.9rem;
      color: var(--primary);
      font-weight: 500;
      min-width: 40px;
    }
    
    .word-pair-divider {
      width: 100%;
      height: 1px;
      background-color: var(--border);
      margin: 0.15rem 0;
    }
    
    /* Display modes toggle */
    .display-toggle {
      display: flex;
      align-items: center;
      margin-bottom: 1rem;
    }
    
    .display-toggle label {
      margin-right: 0.5rem;
      font-size: 0.9rem;
      color: var(--text-light);
    }
    
    .toggle-btn {
      display: flex;
      background: var(--primary-light);
      border-radius: 1rem;
      padding: 0.2rem;
      cursor: pointer;
    }
    
    .toggle-option {
      padding: 0.3rem 0.6rem;
      font-size: 0.8rem;
      border-radius: 0.8rem;
      transition: all 0.3s ease;
    }
    
    .toggle-option.active {
      background: var(--primary);
      color: white;
      font-weight: 500;
    }
    
    /* API Key Modal styles */
    .modal {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background-color: rgba(0, 0, 0, 0.6);
      z-index: 1000;
      overflow: auto;
      animation: fadeIn 0.3s ease;
    }

    .modal.active {
      display: flex;
      justify-content: center;
      align-items: center;
    }

    .modal-content {
      background-color: var(--card-bg);
      border-radius: 1rem;
      box-shadow: 0 8px 30px rgba(0, 0, 0, 0.2);
      width: 90%;
      max-width: 600px;
      overflow: hidden;
      animation: slideUp 0.4s ease;
    }

    .modal-header {
      padding: 1.5rem 2rem;
      border-bottom: 1px solid var(--border);
    }

    .modal-header h2 {
      display: flex;
      align-items: center;
      font-size: 1.5rem;
      margin-bottom: 0.5rem;
      color: var(--primary);
    }

    .modal-header h2 i {
      margin-right: 0.75rem;
    }

    .modal-body {
      padding: 2rem;
    }

    .instruction-steps {
      margin-bottom: 2rem;
    }

    .instruction-steps h3 {
      margin-bottom: 1rem;
      font-size: 1.1rem;
    }

    .instruction-steps ol {
      padding-left: 1.5rem;
      margin-bottom: 1.5rem;
    }

    .instruction-steps li {
      margin-bottom: 0.75rem;
      line-height: 1.5;
    }

    .instruction-steps a {
      color: var(--primary);
      text-decoration: none;
      font-weight: 500;
      transition: all 0.2s ease;
    }

    .instruction-steps a:hover {
      text-decoration: underline;
    }

    .input-group {
      position: relative;
      margin-bottom: 1rem;
    }

    .input-group label {
      display: block;
      margin-bottom: 0.5rem;
      font-weight: 500;
    }

    .input-group input {
      width: 100%;
      padding: 0.85rem 1.2rem;
      padding-right: 3rem;
      border-radius: 0.75rem;
      border: 1px solid var(--border);
      font-size: 1rem;
      background-color: var(--card-bg);
      color: var(--text);
      transition: all 0.3s ease;
    }

    .input-group input:focus {
      outline: none;
      border-color: var(--primary);
      box-shadow: 0 0 0 3px rgba(91, 104, 255, 0.2);
    }

    .toggle-visibility {
      position: absolute;
      right: 1rem;
      top: 2.4rem;
      background: none;
      border: none;
      color: var(--text-light);
      font-size: 1rem;
      cursor: pointer;
    }

    .api-key-note {
      display: flex;
      align-items: center;
      font-size: 0.85rem;
      color: var(--text-light);
      margin-bottom: 1rem;
    }

    .api-key-note i {
      margin-right: 0.5rem;
      color: var(--info);
    }

    .modal-footer {
      padding: 1.5rem 2rem;
      border-top: 1px solid var(--border);
      display: flex;
      justify-content: flex-end;
    }

    .api-key-settings {
      position: fixed;
      bottom: 1rem;
      right: 1rem;
      background: var(--primary-light);
      color: var(--primary);
      width: 40px;
      height: 40px;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
      transition: all 0.3s ease;
      z-index: 100;
    }

    .api-key-settings:hover {
      background: var(--primary);
      color: white;
      transform: rotate(30deg);
    }

    /* Notification styles */
    .notification {
      position: fixed;
      top: 1rem;
      right: 1rem;
      padding: 0.75rem 1.25rem;
      border-radius: 0.5rem;
      color: white;
      font-size: 0.9rem;
      font-weight: 500;
      display: flex;
      align-items: center;
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
      transform: translateX(120%);
      transition: transform 0.3s ease;
      z-index: 1010;
    }
    .notification.show {
      transform: translateX(0);
    }
    .notification i {
      margin-right: 0.5rem;
      font-size: 1rem;
    }
    .notification.success {
      background-color: #28a745;
    }
    .notification.error {
      background-color: #dc3545;
    }
    
    @keyframes spin {
      to {
        transform: rotate(360deg);
      }
    }
    @keyframes fadeIn {
      from {
        opacity: 0;
      }
      to {
        opacity: 1;
      }
    }
    @keyframes slideUp {
      from {
        opacity: 0;
        transform: translateY(20px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }
    @keyframes pulse {
      0% {
        opacity: 1;
      }
      50% {
        opacity: 0.8;
      }
      100% {
        opacity: 1;
      }
    }
    @media (max-width: 768px) {
      .container {
        padding: 1rem;
      }
      .logo-text {
        font-size: 2.5rem;
      }
      .tagline {
        font-size: 1.1rem;
      }
      .language-controls {
        flex-direction: column;
        align-items: center;
        gap: 1rem;
      }
      .language-selector {
        width: 100%;
      }
      .output-area {
        padding: 1.5rem;
      }
      .sentence-block {
        padding: 1.5rem 1.5rem 2.5rem 1.5rem;
      }
      .original, .word-mapping {
        font-size: 1.1rem;
      }
      .btn-container {
        flex-direction: column;
      }
      .output-header {
        flex-direction: column;
        gap: 1rem;
      }
      .output-actions {
        justify-content: center;
      }
      .word-pair {
        min-width: 60px;
      }
      .modal-content {
        width: 95%;
      }
      
      .modal-header, .modal-body, .modal-footer {
        padding: 1rem;
      }
      
      .instruction-steps ol {
        padding-left: 1.2rem;
      }
    }
  </style>
</head>
<body>
  <div class="container">
    <div class="top-controls">
      <button id="theme-toggle" class="theme-toggle" title="Toggle dark mode">
        <i class="fas fa-moon"></i>
      </button>
      <button id="saved-toggle" class="action-btn">
        <i class="fas fa-history"></i> History
      </button>
    </div>
    <header>
      <div class="logo-container">
        <h1 class="logo-text">LinguaLens</h1>
        <span class="logo-badge">Beta</span>
      </div>
      <p class="tagline">Decode foreign languages with the Birkenbihl method and learn more effectively</p>
    </header>
    <div class="info-box">
      <div class="info-icon">
        <i class="fas fa-info-circle"></i>
      </div>
      <div class="info-content">
        <p>The Birkenbihl method helps you learn languages by first understanding exactly what each word means in your native language. This "decoding" phase creates strong neural connections, making language learning more intuitive and effective.</p>
      </div>
    </div>
    <div class="controls-container">
      <div class="language-controls">
        <div class="language-selector">
          <label for="source-lang"><i class="fas fa-globe"></i> Source language:</label>
          <select id="source-lang">
            <option value="ab">Abkhaz</option>
            <option value="ace">Acehnese</option>
            <option value="ach">Acholi</option>
            <option value="aa">Afar</option>
            <option value="af">Afrikaans</option>
            <option value="sq">Albanian</option>
            <option value="alr">Alur</option>
            <option value="am">Amharic</option>
            <option value="ar">Arabic</option>
            <option value="hy">Armenian</option>
            <option value="as">Assamese</option>
            <option value="av">Avar</option>
            <option value="awa">Awadhi</option>
            <option value="ay">Aymara</option>
            <option value="az">Azerbaijani</option>
            <option value="ban">Balinese</option>
            <option value="bal">Baluchi</option>
            <option value="bm">Bambara</option>
            <option value="bci">Baoulé</option>
            <option value="ba">Bashkir</option>
            <option value="eu">Basque</option>
            <option value="btk">Batak Karo</option>
            <option value="bts">Batak Simalungun</option>
            <option value="tbw">Batak Toba</option>
            <option value="be">Belarusian</option>
            <option value="bem">Bemba</option>
            <option value="bn">Bengali</option>
            <option value="bew">Betawi</option>
            <option value="bho">Bhojpuri</option>
            <option value="bik">Bikol</option>
            <option value="bs">Bosnian</option>
            <option value="br">Breton</option>
            <option value="bg">Bulgarian</option>
            <option value="bua">Buryat</option>
            <option value="yue">Cantonese</option>
            <option value="ca">Catalan</option>
            <option value="ceb">Cebuano</option>
            <option value="ch">Chamorro</option>
            <option value="ce">Chechen</option>
            <option value="ny">Chichewa</option>
            <option value="zh-Hans">Chinese (Simplified)</option>
            <option value="zh-Hant">Chinese (Traditional)</option>
            <option value="chk">Chuukese</option>
            <option value="cv">Chuvash</option>
            <option value="co">Corsican</option>
            <option value="crh">Crimean Tatar (Cyrillic)</option>
            <option value="crh-Latn">Crimean Tatar (Latin)</option>
            <option value="hr">Croatian</option>
            <option value="cs">Czech</option>
            <option value="da">Danish</option>
            <option value="prs">Dari</option>
            <option value="dv">Dhivehi</option>
            <option value="din">Dinka</option>
            <option value="doi">Dogri</option>
            <option value="dug">Dombe</option>
            <option value="nl">Dutch</option>
            <option value="dyu">Dyula</option>
            <option value="dz">Dzongkha</option>
            <option value="en">English</option>
            <option value="eo">Esperanto</option>
            <option value="et">Estonian</option>
            <option value="ee">Ewe</option>
            <option value="fo">Faroese</option>
            <option value="fj">Fijian</option>
            <option value="fil">Filipino</option>
            <option value="fi">Finnish</option>
            <option value="fon">Fon</option>
            <option value="fr">French</option>
            <option value="fr-CA">French (Canada)</option>
            <option value="fy">Frisian</option>
            <option value="fur">Friulian</option>
            <option value="ff">Fulani</option>
            <option value="gaa">Ga</option>
            <option value="gl">Galician</option>
            <option value="ka">Georgian</option>
            <option value="de">German</option>
            <option value="el">Greek</option>
            <option value="gn">Guarani</option>
            <option value="gu">Gujarati</option>
            <option value="ht">Haitian Creole</option>
            <option value="hak">Hakha Chin</option>
            <option value="ha">Hausa</option>
            <option value="haw">Hawaiian</option>
            <option value="he">Hebrew</option>
            <option value="hil">Hiligaynon</option>
            <option value="hi">Hindi</option>
            <option value="hmn">Hmong</option>
            <option value="hu">Hungarian</option>
            <option value="hrx">Hunsrik</option>
            <option value="iba">Iban</option>
            <option value="is">Icelandic</option>
            <option value="ig">Igbo</option>
            <option value="ilo">Ilocano</option>
            <option value="id">Indonesian</option>
            <option value="iu">Inuktut (Latin)</option>
            <option value="iu-Syll">Inuktut (Syllabics)</option>
            <option value="ga">Irish</option>
            <option value="it">Italian</option>
            <option value="jam">Jamaican Patois</option>
            <option value="ja">Japanese</option>
            <option value="jv">Javanese</option>
            <option value="kac">Jingpo</option>
            <option value="kl">Kalaallisut</option>
            <option value="kn">Kannada</option>
            <option value="kr">Kanuri</option>
            <option value="pam">Kapampangan</option>
            <option value="kk">Kazakh</option>
            <option value="kha">Khasi</option>
            <option value="km">Khmer</option>
            <option value="ki">Kiga</option>
            <option value="kg">Kikongo</option>
            <option value="rw">Kinyarwanda</option>
            <option value="ktu">Kituba</option>
            <option value="trp">Kokborok</option>
            <option value="kv">Komi</option>
            <option value="kok">Konkani</option>
            <option value="ko">Korean</option>
            <option value="kri">Krio</option>
            <option value="ku">Kurdish (Kurmanji)</option>
            <option value="ckb">Kurdish (Sorani)</option>
            <option value="ky">Kyrgyz</option>
            <option value="lo">Lao</option>
            <option value="ltg">Latgalian</option>
            <option value="la">Latin</option>
            <option value="lv">Latvian</option>
            <option value="lij">Ligurian</option>
            <option value="li">Limburgish</option>
            <option value="ln">Lingala</option>
            <option value="lt">Lithuanian</option>
            <option value="lmo">Lombard</option>
            <option value="lg">Luganda</option>
            <option value="luo">Luo</option>
            <option value="lb">Luxembourgish</option>
            <option value="mk">Macedonian</option>
            <option value="mad">Madurese</option>
            <option value="mai">Maithili</option>
            <option value="mak">Makassar</option>
            <option value="mg">Malagasy</option>
            <option value="ms">Malay</option>
            <option value="ms-Arab">Malay (Jawi)</option>
            <option value="ml">Malayalam</option>
            <option value="mt">Maltese</option>
            <option value="mam">Mam</option>
            <option value="gv">Manx</option>
            <option value="mi">Maori</option>
            <option value="mr">Marathi</option>
            <option value="mh">Marshallese</option>
            <option value="mfe">Mauritian Creole</option>
            <option value="mhr">Meadow Mari</option>
            <option value="mni">Meiteilon (Manipuri)</option>
            <option value="min">Minang</option>
            <option value="lus">Mizo</option>
            <option value="mn">Mongolian</option>
            <option value="my">Myanmar (Burmese)</option>
            <option value="nah">Nahuatl (Eastern Huasteca)</option>
            <option value="ndc">Ndau</option>
            <option value="nr">Ndebele (South)</option>
            <option value="new">Nepalbhasa (Newari)</option>
            <option value="ne">Nepali</option>
            <option value="nqo">NKo</option>
            <option value="no">Norwegian (Bokmål)</option>
            <option value="nus">Nuer</option>
            <option value="oc">Occitan</option>
            <option value="or">Odia (Oriya)</option>
            <option value="om">Oromo</option>
            <option value="os">Ossetian</option>
            <option value="pag">Pangasinan</option>
            <option value="pap">Papiamento</option>
            <option value="ps">Pashto</option>
            <option value="fa">Persian</option>
            <option value="pl">Polish</option>
            <option value="pt-BR">Portuguese (Brazil)</option>
            <option value="pt-PT">Portuguese (Portugal)</option>
            <option value="pa">Punjabi (Gurmukhi)</option>
            <option value="pa-Arab">Punjabi (Shahmukhi)</option>
            <option value="qu">Quechua</option>
            <option value="kek">Qʼeqchiʼ</option>
            <option value="rom">Romani</option>
            <option value="ro">Romanian</option>
            <option value="rn">Rundi</option>
            <option value="ru">Russian</option>
            <option value="se">Sami (North)</option>
            <option value="sm">Samoan</option>
            <option value="sg">Sango</option>
            <option value="sa">Sanskrit</option>
            <option value="sat">Santali (Latin)</option>
            <option value="sat-Olck">Santali (Ol Chiki)</option>
            <option value="gd">Scots Gaelic</option>
            <option value="nso">Sepedi</option>
            <option value="sr">Serbian</option>
            <option value="st">Sesotho</option>
            <option value="crs">Seychellois Creole</option>
            <option value="shn">Shan</option>
            <option value="sn">Shona</option>
            <option value="scn">Sicilian</option>
            <option value="szl">Silesian</option>
            <option value="sd">Sindhi</option>
            <option value="si">Sinhala</option>
            <option value="sk">Slovak</option>
            <option value="sl">Slovenian</option>
            <option value="so">Somali</option>
            <option value="es">Spanish</option>
            <option value="su">Sundanese</option>
            <option value="sus">Susu</option>
            <option value="sw">Swahili</option>
            <option value="ss">Swati</option>
            <option value="sv">Swedish</option>
            <option value="ty">Tahitian</option>
            <option value="tg">Tajik</option>
            <option value="ber">Tamazight</option>
            <option value="ber-Tfng">Tamazight (Tifinagh)</option>
            <option value="ta">Tamil</option>
            <option value="tt">Tatar</option>
            <option value="te">Telugu</option>
            <option value="tet">Tetum</option>
            <option value="th">Thai</option>
            <option value="bo">Tibetan</option>
            <option value="ti">Tigrinya</option>
            <option value="tiv">Tiv</option>
            <option value="tpi">Tok Pisin</option>
            <option value="to">Tongan</option>
            <option value="lua">Tshiluba</option>
            <option value="ts">Tsonga</option>
            <option value="tn">Tswana</option>
            <option value="tcy">Tulu</option>
            <option value="tum">Tumbuka</option>
            <option value="tr">Turkish</option>
            <option value="tk">Turkmen</option>
            <option value="tyv">Tuvan</option>
            <option value="tw">Twi</option>
            <option value="udm">Udmurt</option>
            <option value="uk">Ukrainian</option>
            <option value="ur">Urdu</option>
            <option value="ug">Uyghur</option>
            <option value="uz">Uzbek</option>
            <option value="ve">Venda</option>
            <option value="vec">Venetian</option>
            <option value="vi">Vietnamese</option>
            <option value="war">Waray</option>
            <option value="cy">Welsh</option>
            <option value="wo">Wolof</option>
            <option value="xh">Xhosa</option>
            <option value="sah">Yakut</option>
            <option value="yi">Yiddish</option>
            <option value="yo">Yoruba</option>
            <option value="yua">Yucatec Maya</option>
            <option value="zap">Zapotec</option>
            <option value="zu">Zulu</option>
          </select>
        </div>
        <div class="language-selector">
          <label for="target-lang"><i class="fas fa-language"></i> Your language:</label>
          <select id="target-lang">
            <option value="ab">Abkhaz</option>
            <option value="ace">Acehnese</option>
            <option value="ach">Acholi</option>
            <option value="aa">Afar</option>
            <option value="af">Afrikaans</option>
            <option value="sq">Albanian</option>
            <option value="alr">Alur</option>
            <option value="am">Amharic</option>
            <option value="ar">Arabic</option>
            <option value="hy">Armenian</option>
            <option value="as">Assamese</option>
            <option value="av">Avar</option>
            <option value="awa">Awadhi</option>
            <option value="ay">Aymara</option>
            <option value="az">Azerbaijani</option>
            <option value="ban">Balinese</option>
            <option value="bal">Baluchi</option>
            <option value="bm">Bambara</option>
            <option value="bci">Baoulé</option>
            <option value="ba">Bashkir</option>
            <option value="eu">Basque</option>
            <option value="btk">Batak Karo</option>
            <option value="bts">Batak Simalungun</option>
            <option value="tbw">Batak Toba</option>
            <option value="be">Belarusian</option>
            <option value="bem">Bemba</option>
            <option value="bn">Bengali</option>
            <option value="bew">Betawi</option>
            <option value="bho">Bhojpuri</option>
            <option value="bik">Bikol</option>
            <option value="bs">Bosnian</option>
            <option value="br">Breton</option>
            <option value="bg">Bulgarian</option>
            <option value="bua">Buryat</option>
            <option value="yue">Cantonese</option>
            <option value="ca">Catalan</option>
            <option value="ceb">Cebuano</option>
            <option value="ch">Chamorro</option>
            <option value="ce">Chechen</option>
            <option value="ny">Chichewa</option>
            <option value="zh-Hans">Chinese (Simplified)</option>
            <option value="zh-Hant">Chinese (Traditional)</option>
            <option value="chk">Chuukese</option>
            <option value="cv">Chuvash</option>
            <option value="co">Corsican</option>
            <option value="crh">Crimean Tatar (Cyrillic)</option>
            <option value="crh-Latn">Crimean Tatar (Latin)</option>
            <option value="hr">Croatian</option>
            <option value="cs">Czech</option>
            <option value="da">Danish</option>
            <option value="prs">Dari</option>
            <option value="dv">Dhivehi</option>
            <option value="din">Dinka</option>
            <option value="doi">Dogri</option>
            <option value="dug">Dombe</option>
            <option value="nl">Dutch</option>
            <option value="dyu">Dyula</option>
            <option value="dz">Dzongkha</option>
            <option value="en">English</option>
            <option value="eo">Esperanto</option>
            <option value="et">Estonian</option>
            <option value="ee">Ewe</option>
            <option value="fo">Faroese</option>
            <option value="fj">Fijian</option>
            <option value="fil">Filipino</option>
            <option value="fi">Finnish</option>
            <option value="fon">Fon</option>
            <option value="fr">French</option>
            <option value="fr-CA">French (Canada)</option>
            <option value="fy">Frisian</option>
            <option value="fur">Friulian</option>
            <option value="ff">Fulani</option>
            <option value="gaa">Ga</option>
            <option value="gl">Galician</option>
            <option value="ka">Georgian</option>
            <option value="de">German</option>
            <option value="el">Greek</option>
            <option value="gn">Guarani</option>
            <option value="gu">Gujarati</option>
            <option value="ht">Haitian Creole</option>
            <option value="hak">Hakha Chin</option>
            <option value="ha">Hausa</option>
            <option value="haw">Hawaiian</option>
            <option value="he">Hebrew</option>
            <option value="hil">Hiligaynon</option>
            <option value="hi">Hindi</option>
            <option value="hmn">Hmong</option>
            <option value="hu">Hungarian</option>
            <option value="hrx">Hunsrik</option>
            <option value="iba">Iban</option>
            <option value="is">Icelandic</option>
            <option value="ig">Igbo</option>
            <option value="ilo">Ilocano</option>
            <option value="id">Indonesian</option>
            <option value="iu">Inuktut (Latin)</option>
            <option value="iu-Syll">Inuktut (Syllabics)</option>
            <option value="ga">Irish</option>
            <option value="it">Italian</option>
            <option value="jam">Jamaican Patois</option>
            <option value="ja">Japanese</option>
            <option value="jv">Javanese</option>
            <option value="kac">Jingpo</option>
            <option value="kl">Kalaallisut</option>
            <option value="kn">Kannada</option>
            <option value="kr">Kanuri</option>
            <option value="pam">Kapampangan</option>
            <option value="kk">Kazakh</option>
            <option value="kha">Khasi</option>
            <option value="km">Khmer</option>
            <option value="ki">Kiga</option>
            <option value="kg">Kikongo</option>
            <option value="rw">Kinyarwanda</option>
            <option value="ktu">Kituba</option>
            <option value="trp">Kokborok</option>
            <option value="kv">Komi</option>
            <option value="kok">Konkani</option>
            <option value="ko">Korean</option>
            <option value="kri">Krio</option>
            <option value="ku">Kurdish (Kurmanji)</option>
            <option value="ckb">Kurdish (Sorani)</option>
            <option value="ky">Kyrgyz</option>
            <option value="lo">Lao</option>
            <option value="ltg">Latgalian</option>
            <option value="la">Latin</option>
            <option value="lv">Latvian</option>
            <option value="lij">Ligurian</option>
            <option value="li">Limburgish</option>
            <option value="ln">Lingala</option>
            <option value="lt">Lithuanian</option>
            <option value="lmo">Lombard</option>
            <option value="lg">Luganda</option>
            <option value="luo">Luo</option>
            <option value="lb">Luxembourgish</option>
            <option value="mk">Macedonian</option>
            <option value="mad">Madurese</option>
            <option value="mai">Maithili</option>
            <option value="mak">Makassar</option>
            <option value="mg">Malagasy</option>
            <option value="ms">Malay</option>
            <option value="ms-Arab">Malay (Jawi)</option>
            <option value="ml">Malayalam</option>
            <option value="mt">Maltese</option>
            <option value="mam">Mam</option>
            <option value="gv">Manx</option>
            <option value="mi">Maori</option>
            <option value="mr">Marathi</option>
            <option value="mh">Marshallese</option>
            <option value="mfe">Mauritian Creole</option>
            <option value="mhr">Meadow Mari</option>
            <option value="mni">Meiteilon (Manipuri)</option>
            <option value="min">Minang</option>
            <option value="lus">Mizo</option>
            <option value="mn">Mongolian</option>
            <option value="my">Myanmar (Burmese)</option>
            <option value="nah">Nahuatl (Eastern Huasteca)</option>
            <option value="ndc">Ndau</option>
            <option value="nr">Ndebele (South)</option>
            <option value="new">Nepalbhasa (Newari)</option>
            <option value="ne">Nepali</option>
            <option value="nqo">NKo</option>
            <option value="no">Norwegian (Bokmål)</option>
            <option value="nus">Nuer</option>
            <option value="oc">Occitan</option>
            <option value="or">Odia (Oriya)</option>
            <option value="om">Oromo</option>
            <option value="os">Ossetian</option>
            <option value="pag">Pangasinan</option>
            <option value="pap">Papiamento</option>
            <option value="ps">Pashto</option>
            <option value="fa">Persian</option>
            <option value="pl">Polish</option>
            <option value="pt-BR">Portuguese (Brazil)</option>
            <option value="pt-PT">Portuguese (Portugal)</option>
            <option value="pa">Punjabi (Gurmukhi)</option>
            <option value="pa-Arab">Punjabi (Shahmukhi)</option>
            <option value="qu">Quechua</option>
            <option value="kek">Qʼeqchiʼ</option>
            <option value="rom">Romani</option>
            <option value="ro">Romanian</option>
            <option value="rn">Rundi</option>
            <option value="ru">Russian</option>
            <option value="se">Sami (North)</option>
            <option value="sm">Samoan</option>
            <option value="sg">Sango</option>
            <option value="sa">Sanskrit</option>
            <option value="sat">Santali (Latin)</option>
            <option value="sat-Olck">Santali (Ol Chiki)</option>
            <option value="gd">Scots Gaelic</option>
            <option value="nso">Sepedi</option>
            <option value="sr">Serbian</option>
            <option value="st">Sesotho</option>
            <option value="crs">Seychellois Creole</option>
            <option value="shn">Shan</option>
            <option value="sn">Shona</option>
            <option value="scn">Sicilian</option>
            <option value="szl">Silesian</option>
            <option value="sd">Sindhi</option>
            <option value="si">Sinhala</option>
            <option value="sk">Slovak</option>
            <option value="sl">Slovenian</option>
            <option value="so">Somali</option>
            <option value="es">Spanish</option>
            <option value="su">Sundanese</option>
            <option value="sus">Susu</option>
            <option value="sw">Swahili</option>
            <option value="ss">Swati</option>
            <option value="sv">Swedish</option>
            <option value="ty">Tahitian</option>
            <option value="tg">Tajik</option>
            <option value="ber">Tamazight</option>
            <option value="ber-Tfng">Tamazight (Tifinagh)</option>
            <option value="ta">Tamil</option>
            <option value="tt">Tatar</option>
            <option value="te">Telugu</option>
            <option value="tet">Tetum</option>
            <option value="th">Thai</option>
            <option value="bo">Tibetan</option>
            <option value="ti">Tigrinya</option>
            <option value="tiv">Tiv</option>
            <option value="tpi">Tok Pisin</option>
            <option value="to">Tongan</option>
            <option value="lua">Tshiluba</option>
            <option value="ts">Tsonga</option>
            <option value="tn">Tswana</option>
            <option value="tcy">Tulu</option>
            <option value="tum">Tumbuka</option>
            <option value="tr">Turkish</option>
            <option value="tk">Turkmen</option>
            <option value="tyv">Tuvan</option>
            <option value="tw">Twi</option>
            <option value="udm">Udmurt</option>
            <option value="uk">Ukrainian</option>
            <option value="ur">Urdu</option>
            <option value="ug">Uyghur</option>
            <option value="uz">Uzbek</option>
            <option value="ve">Venda</option>
            <option value="vec">Venetian</option>
            <option value="vi">Vietnamese</option>
            <option value="war">Waray</option>
            <option value="cy">Welsh</option>
            <option value="wo">Wolof</option>
            <option value="xh">Xhosa</option>
            <option value="sah">Yakut</option>
            <option value="yi">Yiddish</option>
            <option value="yo">Yoruba</option>
            <option value="yua">Yucatec Maya</option>
            <option value="zap">Zapotec</option>
            <option value="zu">Zulu</option>
          </select>
        </div>
      </div>
    </div>
    <div class="input-area">
      <div class="textarea-container">
        <textarea id="input-text" placeholder="Enter text in the foreign language you want to learn..."></textarea>
        <div class="character-count">0/1000</div>
      </div>
      <div class="example-texts">
        <div class="example-text" data-lang="fr">Bonjour, comment allez-vous?</div>
        <div class="example-text" data-lang="es">Me gustaría aprender español</div>
        <div class="example-text" data-lang="de">Ich möchte Deutsch lernen</div>
        <div class="example-text" data-lang="it">La vita è bella</div>
      </div>
      <div class="btn-container">
        <button id="process-btn" class="primary-button">
          <i class="fas fa-language"></i> Decode Text
        </button>
        <button id="clear-btn" class="secondary-button">
          <i class="fas fa-trash-alt"></i> Clear
        </button>
      </div>
    </div>
    <div id="output-area" class="output-area">
      <div class="output-header">
        <div class="output-title">Decoded Translation</div>
        <div class="output-actions">
          <button class="output-action" id="copy-all">
            <i class="fas fa-copy"></i> Copy
          </button>
          <button class="output-action" id="download-translations">
            <i class="fas fa-download"></i> Export
          </button>
        </div>
      </div>
      <div id="output-content"></div>
    </div>
    <div id="saved-translations" class="saved-translations">
      <h2><i class="fas fa-history"></i> Translation History</h2>
      <div id="saved-list" class="saved-list"></div>
    </div>
  </div>
  
  <!-- API Key Modal -->
  <div id="api-key-modal" class="modal">
    <div class="modal-content">
      <div class="modal-header">
        <h2><i class="fas fa-key"></i> API Key Required</h2>
        <p> LinguaLens uses Gemini AI to translate and analyse text so you have to provide your Gemini API key.</p>
      </div>
      
      <div class="modal-body">
        <div class="instruction-steps">
          <h3>How to get your free Gemini API key:</h3>
          <ol>
            <li>Go to <a href="https://aistudio.google.com/app/apikey" target="_blank" rel="noopener">Google AI Studio</a></li>
            <li>Sign in with your Google account</li>
            <li>Click on "Create API key" button</li>
            <li>Copy your new API key</li>
            <li>Paste it below</li>
          </ol>
        </div>
        
        <div class="api-form">
          <div class="input-group">
            <label for="gemini-api-key">Your Gemini API Key:</label>
            <input type="password" id="gemini-api-key" placeholder="Paste your API key here" />
            <button type="button" id="toggle-key-visibility" class="toggle-visibility">
              <i class="fas fa-eye"></i>
            </button>
          </div>
          <div class="api-key-note">
            <i class="fas fa-info-circle"></i>
            <span>Your API key is stored only in your browser and never sent to our servers.</span>
          </div>
        </div>
      </div>
      
      <div class="modal-footer">
        <button id="save-api-key" class="primary-button">
          <i class="fas fa-save"></i> Save API Key
        </button>
      </div>
    </div>
  </div>
  
  <div class="api-key-settings" title="API Key Settings">
    <i class="fas fa-key"></i>
  </div>
  
  <footer>
    <p>LinguaLens - Language Learning with the Birkenbihl Method</p>
    <p>© 2025 LinguaLens</p>
  </footer>
  
  <script>
    // Character counter
    const textarea = document.getElementById('input-text');
    const charCount = document.querySelector('.character-count');
    
    textarea.addEventListener('input', function() {
      charCount.textContent = `${this.value.length}/1000`;
      if (this.value.length > 1000) {
        charCount.style.color = 'var(--danger)';
      } else {
        charCount.style.color = 'var(--text-light)';
      }
    });
    
    // Theme toggle
    const themeToggle = document.getElementById('theme-toggle');
    const body = document.body;
    
    // Check if user has a saved preference
    const darkMode = localStorage.getItem('darkMode') === 'true';
    if (darkMode) {
      body.classList.add('dark-mode');
      themeToggle.innerHTML = '<i class="fas fa-sun"></i>';
    }
    
    themeToggle.addEventListener('click', function() {
      body.classList.toggle('dark-mode');
      const isDark = body.classList.contains('dark-mode');
      localStorage.setItem('darkMode', isDark);
      themeToggle.innerHTML = isDark ? '<i class="fas fa-sun"></i>' : '<i class="fas fa-moon"></i>';
    });
    
    // Clear button
    document.getElementById('clear-btn').addEventListener('click', function() {
      document.getElementById('input-text').value = '';
      charCount.textContent = '0/1000';
      document.getElementById('output-area').classList.remove('visible');
    });
    
    // Example texts
    const exampleTexts = document.querySelectorAll('.example-text');
    
    exampleTexts.forEach(example => {
      example.addEventListener('click', function() {
        document.getElementById('input-text').value = this.textContent;
        document.getElementById('source-lang').value = this.getAttribute('data-lang');
        charCount.textContent = `${this.textContent.length}/1000`;
      });
    });
    
    // Process button
    document.getElementById('process-btn').addEventListener('click', processText);
    
    // History toggle
    document.getElementById('saved-toggle').addEventListener('click', function() {
      document.getElementById('saved-translations').classList.toggle('visible');
      loadHistory();
    });
    
    // Save to history
    function saveToHistory(text, sourceLang, targetLang) {
      // Get existing history or initialize new array
      let history = JSON.parse(localStorage.getItem('translationHistory')) || [];
      
      // Add new item
      history.unshift({
        id: Date.now(),
        text: text,
        sourceLang: sourceLang,
        targetLang: targetLang,
        date: new Date().toISOString()
      });
      
      // Limit history to 20 items
      if (history.length > 20) {
        history.pop();
      }
      
      // Save updated history
      localStorage.setItem('translationHistory', JSON.stringify(history));
    }
    
    // Load history
    function loadHistory() {
      const savedList = document.getElementById('saved-list');
      const history = JSON.parse(localStorage.getItem('translationHistory')) || [];
      
      if (history.length === 0) {
        savedList.innerHTML = `
          <div class="no-saved">
            <i class="fas fa-history"></i>
            <p>No translation history yet</p>
          </div>
        `;
        return;
      }
      
      savedList.innerHTML = '';
      
      history.forEach(item => {
        const date = new Date(item.date).toLocaleString();
        const sourceLang = getLanguageFullName(item.sourceLang);
        
        const historyItem = document.createElement('div');
        historyItem.className = 'saved-item';
        historyItem.dataset.text = item.text;
        historyItem.dataset.sourceLang = item.sourceLang;
        historyItem.dataset.targetLang = item.targetLang;
        historyItem.innerHTML = `
          <div class="saved-item-header">
            <div class="saved-item-lang">${sourceLang}</div>
            <div class="saved-item-date">${date}</div>
          </div>
          <div class="saved-item-text">${item.text}</div>
        `;
        
        historyItem.addEventListener('click', function() {
          document.getElementById('input-text').value = this.dataset.text;
          document.getElementById('source-lang').value = this.dataset.sourceLang;
          charCount.textContent = `${this.dataset.text.length}/1000`;
          document.getElementById('saved-translations').classList.remove('visible');
          processText();
        });
        
        savedList.appendChild(historyItem);
      });
    }
    
    function getLanguageFullName(code) {
      const languages = {
        'en': 'English',
        'fr': 'French',
        'es': 'Spanish',
        'de': 'German',
        'it': 'Italian',
        'ja': 'Japanese',
        'ru': 'Russian',
        'zh': 'Chinese',
        'ar': 'Arabic',
        'pt': 'Portuguese',
        'hi': 'Hindi',
        'ko': 'Korean'
      };
      
      return languages[code] || code;
    }
    
    // API key management
    document.addEventListener('DOMContentLoaded', function() {
      // Check if API key exists in localStorage
      const apiKey = localStorage.getItem('geminiApiKey');
      const apiKeyModal = document.getElementById('api-key-modal');
      
      // Show modal if no API key is saved
      if (!apiKey) {
        apiKeyModal.classList.add('active');
      }
      
      // Toggle password visibility
      const toggleKeyVisibility = document.getElementById('toggle-key-visibility');
      const apiKeyInput = document.getElementById('gemini-api-key');
      
      toggleKeyVisibility.addEventListener('click', function() {
        const type = apiKeyInput.getAttribute('type') === 'password' ? 'text' : 'password';
        apiKeyInput.setAttribute('type', type);
        toggleKeyVisibility.innerHTML = type === 'password' ? 
          '<i class="fas fa-eye"></i>' : 
          '<i class="fas fa-eye-slash"></i>';
      });
      
      // Save API key
      const saveApiKeyBtn = document.getElementById('save-api-key');
      
      saveApiKeyBtn.addEventListener('click', function() {
        const newApiKey = apiKeyInput.value.trim();
        
        if (newApiKey) {
          localStorage.setItem('geminiApiKey', newApiKey);
          apiKeyModal.classList.remove('active');
          showNotification('API key saved successfully!', 'success');
        } else {
          showNotification('Please enter a valid API key', 'error');
        }
      });
      
      // API key settings button event
      document.querySelector('.api-key-settings').addEventListener('click', function() {
        // If API key exists, pre-fill the input
        if (apiKey) {
          apiKeyInput.value = apiKey;
        }
        apiKeyModal.classList.add('active');
      });
    });
    
    // Notification system
    function showNotification(message, type) {
      // Remove any existing notifications
      const existingNotifications = document.querySelectorAll('.notification');
      existingNotifications.forEach(notification => {
        document.body.removeChild(notification);
      });
      
      const notification = document.createElement('div');
      notification.className = `notification ${type}`;
      notification.innerHTML = `<i class="fas fa-${type === 'success' ? 'check-circle' : 'exclamation-circle'}"></i> ${message}`;
      document.body.appendChild(notification);
      
      setTimeout(() => {
        notification.classList.add('show');
      }, 10);
      
      setTimeout(() => {
        notification.classList.remove('show');
        setTimeout(() => {
          document.body.removeChild(notification);
        }, 300);
      }, 3000);
    }
    
    // Process text function with API key handling
    function processText() {
      const text = document.getElementById('input-text').value;
      if (!text.trim()) {
        showNotification('Please enter some text to process', 'error');
        return;
      }

      const sourceLang = document.getElementById('source-lang').value;
      const targetLang = document.getElementById('target-lang').value || 'en';
      
      // Get the API key from localStorage
      const apiKey = localStorage.getItem('geminiApiKey');
      
      // Check if API key exists
      if (!apiKey) {
        document.getElementById('api-key-modal').classList.add('active');
        showNotification('Please set your API key first', 'error');
        return;
      }
      
      // Show loading state
      document.getElementById('output-area').classList.add('visible');
      document.getElementById('output-content').innerHTML = `
        <div class="loading">
          <div class="spinner"></div>
          <div class="loading-text">Processing your text...</div>
          <div class="processing-steps">
            <div class="processing-step"><i class="fas fa-circle-notch fa-spin"></i> Analyzing text structure</div>
            <div class="processing-step"><i class="fas fa-circle-notch fa-spin"></i> Breaking down into sentences</div>
            <div class="processing-step"><i class="fas fa-circle-notch fa-spin"></i> Translating word-by-word</div>
          </div>
        </div>
      `;
      
      // Save to history
      saveToHistory(text, sourceLang, targetLang);
      
      // Send request to server with API key
      fetch('/process', {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json',
        },
        body: JSON.stringify({
          text: text,
          sourceLang: sourceLang,
          targetLang: targetLang,
          apiKey: apiKey // Send the API key with the request
        }),
      })
      .then(response => {
        const reader = response.body.getReader();
        const decoder = new TextDecoder();
        let buffer = '';
        
        // For real-time updating as responses come in
        document.getElementById('output-content').innerHTML = '';
        
        function read() {
          return reader.read().then(({ value, done }) => {
            if (done) {
              // Process any remaining data in buffer
              if (buffer) {
                try {
                  const result = JSON.parse(buffer);
                  appendTranslation(result);
                } catch (e) {
                  console.error('Error parsing final chunk:', e);
                }
              }
              return;
            }
            
            const chunk = decoder.decode(value, { stream: true });
            buffer += chunk;
            
            // Process complete JSON objects in the buffer
            let newlineIndex;
            while ((newlineIndex = buffer.indexOf('\n')) !== -1) {
              const line = buffer.substring(0, newlineIndex);
              buffer = buffer.substring(newlineIndex + 1);
              
              try {
                if (line.trim()) {
                  const result = JSON.parse(line);
                  appendTranslation(result);
                  
                  // Update processing steps to show progress
                  document.querySelector('.processing-step:nth-child(1)').classList.add('completed');
                  document.querySelector('.processing-step:nth-child(1) i').className = 'fas fa-check';
                  document.querySelector('.processing-step:nth-child(2)').classList.add('completed');
                  document.querySelector('.processing-step:nth-child(2) i').className = 'fas fa-check';
                }
              } catch (e) {
                console.error('Error parsing chunk:', e);
              }
            }
            
            return read();
          });
        }
        
        read().catch(error => {
          document.getElementById('output-content').innerHTML = `
            <div class="error">
              <i class="fas fa-exclamation-triangle"></i>
              <h3>Oops! Something went wrong.</h3>
              <p>${error.message}</p>
              <button class="retry-btn" onclick="processText()"><i class="fas fa-redo"></i> Try Again</button>
            </div>
          `;
        });
      })
      .catch(error => {
        document.getElementById('output-content').innerHTML = `
          <div class="error">
            <i class="fas fa-exclamation-triangle"></i>
            <h3>Oops! Something went wrong.</h3>
            <p>${error.message}</p>
            <button class="retry-btn" onclick="processText()"><i class="fas fa-redo"></i> Try Again</button>
          </div>
        `;
      });
    }
    
    // Append a new translation result to the output area
function appendTranslation(result) {
    // Remove loading indicator if it's the first result
    const loadingElement = document.querySelector('.loading');
    if (loadingElement) {
        loadingElement.remove();
    }
    
    const outputContent = document.getElementById('output-content');
    const sentenceBlock = document.createElement('div');
    sentenceBlock.className = 'sentence-block';
    
    // Check if we have an error
    if (result.error) {
        sentenceBlock.innerHTML = `
            <div class="error">
                <i class="fas fa-exclamation-triangle"></i>
                <h3>Error processing sentence</h3>
                <p>${result.error}</p>
            </div>
        `;
        outputContent.appendChild(sentenceBlock);
        return;
    }
    
    // Get sentence number
    const sentenceNumber = outputContent.children.length + 1;
    
    // Create HTML for the block
    let romanizationHtml = '';
    if (result.romanization) {
        romanizationHtml = `<div class="romanization">${result.romanization}</div>`;
    }
    
    sentenceBlock.innerHTML = `
        <div class="sentence-header">
            <div class="sentence-number">Sentence ${sentenceNumber}</div>
            <div class="display-toggle">
                <label>Display:</label>
                <div class="toggle-btn">
                    <div class="toggle-option active" data-mode="traditional">Text</div>
                    <div class="toggle-option" data-mode="aligned">Aligned</div>
                </div>
            </div>
        </div>
        <div class="original">${result.original}</div>
        ${romanizationHtml}
        <div class="traditional-view">
            <div class="word-mapping">${result.wordByWord}</div>
            <div class="translation">${result.fluentTranslation}</div>
        </div>
        <div class="aligned-view" style="display: none;">
            <div class="aligned-translation">
                <!-- Will be populated by JavaScript -->
            </div>
        </div>
        <button class="grammar-btn" title="Grammar explanation">
            <i class="fas fa-book"></i>
        </button>
        <button class="speak-btn" title="Listen">
            <i class="fas fa-volume-up"></i>
        </button>
    `;
    
    outputContent.appendChild(sentenceBlock);
    
    // Set up the aligned view
    const alignedContainer = sentenceBlock.querySelector('.aligned-translation');
    // Use romanization for alignment if available, otherwise use original
    const textToSplit = result.romanization || result.original;
    const originalWords = textToSplit.split(/\s+/);
    const translatedWords = result.wordByWord.split(/\s+/);
    
    // Make sure we have the same number of words
    const minLength = Math.min(originalWords.length, translatedWords.length);
    
    for (let i = 0; i < minLength; i++) {
        const wordPair = document.createElement('div');
        wordPair.className = 'word-pair';
        wordPair.innerHTML = `
            <div class="original-word">${originalWords[i]}</div>
            <div class="word-pair-divider"></div>
            <div class="translation-word">${translatedWords[i]}</div>
        `;
        alignedContainer.appendChild(wordPair);
    }
    
    // Set up display toggle
    sentenceBlock.querySelector('.toggle-btn').addEventListener('click', function(e) {
        if (e.target.classList.contains('toggle-option')) {
            // Update active state
            sentenceBlock.querySelectorAll('.toggle-option').forEach(option => {
                option.classList.remove('active');
            });
            e.target.classList.add('active');
            
            // Show/hide views
            const mode = e.target.dataset.mode;
            if (mode === 'traditional') {
                sentenceBlock.querySelector('.traditional-view').style.display = 'block';
                sentenceBlock.querySelector('.aligned-view').style.display = 'none';
            } else {
                sentenceBlock.querySelector('.traditional-view').style.display = 'none';
                sentenceBlock.querySelector('.aligned-view').style.display = 'block';
            }
        }
    });
    
    // Set up text-to-speech
    const speakButton = sentenceBlock.querySelector('.speak-btn');
    speakButton.addEventListener('click', function() {
        const text = result.original;
        speak(text, document.getElementById('source-lang').value);
    });
    
    // Set up grammar explanation
    const grammarButton = sentenceBlock.querySelector('.grammar-btn');
    grammarButton.addEventListener('click', function() {
        const existingExplanation = sentenceBlock.nextElementSibling;
        if (existingExplanation && existingExplanation.classList.contains('grammar-explanation')) {
            existingExplanation.remove();
            return;
        }

        const targetLang = document.getElementById('target-lang').value;
        getGrammarExplanation(result.original, document.getElementById('source-lang').value, targetLang, this);
    });
}
    
    // Grammar explanation function with API key handling
    function getGrammarExplanation(sentence, sourceLang, targetLang, grammarButton) {
  // Get API key
  const apiKey = localStorage.getItem('geminiApiKey');
  
  if (!apiKey) {
    document.getElementById('api-key-modal').classList.add('active');
    showNotification('Please set your API key first', 'error');
    return;
  }
  
  // Show loading state in the grammar explanation area
  const explanationId = `grammar-explanation-${Date.now()}`;
  const explanationContainer = document.createElement('div');
  explanationContainer.className = 'grammar-explanation visible';
  explanationContainer.id = explanationId;
  explanationContainer.innerHTML = `
    <div class="grammar-loading">
      <i class="fas fa-circle-notch fa-spin"></i> Generating grammar explanation...
    </div>
  `;
  
  // Insert after the button's parent element (sentence-block)
  const sentenceBlock = grammarButton.closest('.sentence-block');
  sentenceBlock.insertAdjacentElement('afterend', explanationContainer);
  
  // Send request to server with the API key
  fetch('/grammar-explanation', {
    method: 'POST',
    headers: {
      'Content-Type': 'application/json',
    },
    body: JSON.stringify({
      sentence: sentence,
      sourceLang: sourceLang,
      targetLang: targetLang,
      apiKey: apiKey
    }),
  })
  .then(response => response.json())
  .then(data => {
    if (data.error) {
      document.getElementById(explanationId).innerHTML = `
        <div class="grammar-title"><i class="fas fa-exclamation-triangle"></i> Error</div>
        <p>Unable to generate grammar explanation: ${data.error}</p>
      `;
      return;
    }
    
    // Initialize raw content
    let rawContent = '';
    
    
    // Display the raw content as-is, wrapped in <pre> to preserve whitespace and line breaks
    document.getElementById(explanationId).innerHTML = `
      <div class="grammar-title"><i class="fas fa-book"></i> Grammar Explanation</div>
      <pre>${rawContent}</pre>
    `;
  })
  .catch(error => {
    document.getElementById(explanationId).innerHTML = `
      <div class="grammar-title"><i class="fas fa-exclamation-triangle"></i> Error</div>
      <p>Unable to generate grammar explanation: ${error.message}</p>
    `;
  });
}
    
    // Text-to-speech function
    function speak(text, lang) {
      const utterance = new SpeechSynthesisUtterance(text);
      utterance.lang = lang;
      window.speechSynthesis.speak(utterance);
    }
    
    // Copy all translated content
    document.getElementById('copy-all').addEventListener('click', function() {
      let content = '';
      
      const sentences = document.querySelectorAll('.sentence-block');
      sentences.forEach(sentence => {
        const original = sentence.querySelector('.original').textContent;
        const wordByWord = sentence.querySelector('.word-mapping').textContent;
        const translation = sentence.querySelector('.translation').textContent;
        
        content += `${original}\n${wordByWord}\n${translation}\n\n`;
      });
      
      navigator.clipboard.writeText(content).then(
        function() {
          showNotification('Copied to clipboard!', 'success');
        }, 
        function(err) {
          showNotification('Could not copy text: ' + err, 'error');
        }
      );
    });
    
    // Download translations as text file
    document.getElementById('download-translations').addEventListener('click', function() {
      let content = '';
      
      const sentences = document.querySelectorAll('.sentence-block');
      sentences.forEach(sentence => {
        const original = sentence.querySelector('.original').textContent;
        const wordByWord = sentence.querySelector('.word-mapping').textContent;
        const translation = sentence.querySelector('.translation').textContent;
        
        content += `${original}\n${wordByWord}\n${translation}\n\n`;
      });
      
      const blob = new Blob([content], { type: 'text/plain' });
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url;
      a.download = 'lingualens_translation.txt';
      document.body.appendChild(a);
      a.click();
      document.body.removeChild(a);
      URL.revokeObjectURL(url);
    });
  </script>
</body>
</html>
