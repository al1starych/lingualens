<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>LinguaLens | Learn Languages with Birkenbihl Method</title>
  <meta name="description" content="LinguaLens helps you learn foreign languages more effectively using the Birkenbihl method - decoding languages word by word">
  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  <link
    href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap"
    rel="stylesheet"
  />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
  <style>
    :root {
      --primary: #5b68ff;
      --primary-dark: #4355f0;
      --primary-light: #e8ebff;
      --secondary: #ff6b6b;
      --secondary-dark: #ff5252;
      --text: #2a2f45;
      --text-light: #6c757d;
      --bg: #fcfdff;
      --card-bg: #ffffff;
      --border: #e4e8f0;
      --success: #28a745;
      --info: #17a2b8;
      --warning: #ffc107;
      --danger: #dc3545;
    }
    .dark-mode {
      --primary: #7c86ff;
      --primary-dark: #6169ff;
      --primary-light: #282f60;
      --secondary: #ff8585;
      --secondary-dark: #ff6969;
      --text: #f1f3f5;
      --text-light: #adb5bd;
      --bg: #121826;
      --card-bg: #1e293b;
      --border: #2c3a52;
    }
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }
    body {
      font-family: "Inter", sans-serif;
      background-color: var(--bg);
      color: var(--text);
      line-height: 1.6;
      transition: all 0.3s ease;
    }
    .container {
      max-width: 1140px;
      margin: 0 auto;
      padding: 2rem;
    }
    header {
      text-align: center;
      margin-bottom: 3rem;
      animation: fadeIn 0.8s ease;
    }
    .logo-container {
      margin-bottom: 1rem;
      display: inline-block;
      position: relative;
    }
    .logo-text {
      font-size: 3.5rem;
      font-weight: 800;
      background: linear-gradient(90deg, var(--primary), var(--secondary));
      -webkit-background-clip: text;
      background-clip: text;
      color: transparent;
      margin-bottom: 0.5rem;
      animation: pulse 5s infinite alternate;
    }
    .logo-badge {
      position: absolute;
      top: -5px;
      right: -40px;
      background: var(--secondary);
      color: white;
      font-size: 0.8rem;
      padding: 0.2rem 0.5rem;
      border-radius: 20px;
      font-weight: 600;
      transform: rotate(15deg);
      box-shadow: 0 3px 6px rgba(0, 0, 0, 0.1);
    }
    .tagline {
      font-size: 1.3rem;
      color: var(--text-light);
      max-width: 600px;
      margin: 0 auto;
      line-height: 1.5;
    }
    .info-box {
      background: var(--primary-light);
      border-radius: 0.75rem;
      padding: 1.5rem;
      margin-bottom: 2rem;
      display: flex;
      align-items: flex-start;
      animation: slideUp 0.8s ease;
      box-shadow: 0 4px 6px rgba(91, 104, 255, 0.1);
    }
    .info-icon {
      margin-right: 1rem;
      font-size: 1.5rem;
      color: var(--primary);
    }
    .info-content h3 {
      margin-bottom: 0.5rem;
      font-weight: 600;
      color: var(--primary-dark);
    }
    .info-content p {
      color: var(--text);
      font-size: 0.95rem;
    }
    .controls-container {
      display: flex;
      flex-direction: column;
      gap: 2rem;
      margin-bottom: 2rem;
      animation: slideUp 0.6s ease;
    }
    .language-controls {
      display: flex;
      justify-content: center;
      gap: 2rem;
      margin-bottom: 1rem;
      flex-wrap: wrap;
    }
    .language-selector {
      display: flex;
      flex-direction: column;
      min-width: 200px;
    }
    .language-selector label {
      margin-bottom: 0.5rem;
      font-weight: 500;
      display: flex;
      align-items: center;
    }
    .language-selector label i {
      margin-right: 0.5rem;
      color: var(--primary);
    }
    .quick-actions {
      display: flex;
      justify-content: center;
      gap: 1rem;
      margin-bottom: 1rem;
    }
    .action-btn {
      padding: 0.5rem 1rem;
      background: var(--primary-light);
      color: var(--primary);
      border: none;
      border-radius: 0.5rem;
      font-size: 0.9rem;
      font-weight: 500;
      cursor: pointer;
      transition: all 0.3s ease;
      display: flex;
      align-items: center;
    }
    .action-btn i {
      margin-right: 0.5rem;
    }
    .action-btn:hover {
      background: var(--primary);
      color: white;
    }
    select {
      padding: 0.85rem 1.2rem;
      border-radius: 0.75rem;
      border: 1px solid var(--border);
      font-size: 1rem;
      background-color: var(--card-bg);
      box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
      transition: all 0.3s ease;
      color: var(--text);
      -webkit-appearance: none;
      -moz-appearance: none;
      appearance: none;
      background-repeat: no-repeat;
      background-position: right 1rem top 50%;
      background-size: 0.65rem auto;
      padding-right: 2.5rem;
    }
    select:focus {
      outline: none;
      border-color: var(--primary);
      box-shadow: 0 0 0 3px rgba(91, 104, 255, 0.2);
    }
    .input-area {
      margin-bottom: 2rem;
      animation: slideUp 0.6s ease;
    }
    .textarea-container {
      position: relative;
      margin-bottom: 1rem;
    }
    textarea {
      width: 100%;
      height: 150px;
      padding: 1.25rem;
      border-radius: 0.75rem;
      border: 1px solid var(--border);
      font-family: inherit;
      font-size: 1rem;
      resize: vertical;
      transition: all 0.3s ease;
      box-shadow: 0 4px 6px rgba(0, 0, 0, 0.05);
      color: var(--text);
      background-color: var(--card-bg);
    }
    textarea:focus {
      outline: none;
      border-color: var(--primary);
      box-shadow: 0 0 0 3px rgba(91, 104, 255, 0.2);
    }
    .character-count {
      position: absolute;
      bottom: 0.5rem;
      right: 0.5rem;
      font-size: 0.8rem;
      color: var(--text-light);
      pointer-events: none;
    }
    .example-texts {
      display: flex;
      flex-wrap: wrap;
      gap: 0.5rem;
      margin-bottom: 1rem;
    }
    .example-text {
      font-size: 0.85rem;
      padding: 0.4rem 0.75rem;
      background: var(--primary-light);
      color: var(--primary);
      border-radius: 0.5rem;
      cursor: pointer;
      transition: all 0.2s ease;
    }
    .example-text:hover {
      background: var(--primary);
      color: white;
    }
    .btn-container {
      display: flex;
      justify-content: center;
      gap: 1rem;
    }
    button.primary-button {
      display: inline-flex;
      align-items: center;
      justify-content: center;
      padding: 0.85rem 2.5rem;
      border: none;
      border-radius: 0.5rem;
      background: linear-gradient(90deg, var(--primary), #7664ff);
      color: white;
      font-family: inherit;
      font-size: 1rem;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s ease;
      box-shadow: 0 4px 10px rgba(91, 104, 255, 0.3);
    }
    button.primary-button i {
      margin-right: 0.5rem;
    }
    button.primary-button:hover {
      transform: translateY(-2px);
      box-shadow: 0 6px 15px rgba(91, 104, 255, 0.4);
    }
    button.primary-button:active {
      transform: translateY(0);
    }
    button.secondary-button {
      display: inline-flex;
      align-items: center;
      justify-content: center;
      padding: 0.85rem 2rem;
      border: 1px solid var(--border);
      border-radius: 0.5rem;
      background: var(--card-bg);
      color: var(--text);
      font-family: inherit;
      font-size: 1rem;
      font-weight: 500;
      cursor: pointer;
      transition: all 0.3s ease;
    }
    button.secondary-button i {
      margin-right: 0.5rem;
    }
    button.secondary-button:hover {
      background: var(--primary-light);
      color: var(--primary);
      border-color: var(--primary-light);
    }
    .output-area {
      background-color: var(--card-bg);
      border-radius: 1rem;
      box-shadow: 0 8px 20px rgba(0, 0, 0, 0.08);
      padding: 2rem;
      margin-top: 2rem;
      opacity: 0;
      transform: translateY(20px);
      transition: all 0.5s ease;
    }
    .output-area.visible {
      opacity: 1;
      transform: translateY(0);
    }
    .output-header {
      display: flex;
      justify-content: space-between;
      margin-bottom: 1.5rem;
      padding-bottom: 1rem;
      border-bottom: 1px solid var(--border);
    }
    .output-title {
      font-size: 1.25rem;
      font-weight: 600;
      color: var(--text);
    }
    .output-actions {
      display: flex;
      gap: 1rem;
    }
    .output-action {
      background: none;
      border: none;
      color: var(--primary);
      font-size: 1rem;
      cursor: pointer;
      transition: all 0.2s ease;
      display: flex;
      align-items: center;
    }
    .output-action i {
      margin-right: 0.3rem;
    }
    .output-action:hover {
      color: var(--primary-dark);
    }
    .sentence-block {
      margin-bottom: 2rem;
      padding: 2rem 2rem 2.5rem 2rem;
      border-bottom: 1px solid var(--border);
      position: relative;
      transition: all 0.3s ease;
    }
    .sentence-block:hover {
      background-color: var(--primary-light);
      border-radius: 0.5rem;
    }
    .sentence-block:last-child {
      margin-bottom: 0;
      padding-bottom: 0;
      border-bottom: none;
    }
    .sentence-header {
      display: flex;
      justify-content: space-between;
      margin-bottom: 1rem;
    }
    .sentence-number {
      font-size: 0.9rem;
      font-weight: 500;
      color: var(--text-light);
    }
    .original {
      font-size: 1.35rem;
      margin-bottom: 1rem;
      line-height: 1.8;
      font-weight: 500;
    }
    .word-mapping {
      font-size: 1.1rem;
      margin-bottom: 1rem;
      color: var(--primary);
      line-height: 1.8;
    }
    .translation {
      font-size: 1rem;
      color: var(--text-light);
      font-style: italic;
      margin-bottom: 1rem;
    }
    .word {
      display: inline-block;
      position: relative;
      cursor: pointer;
      transition: all 0.2s ease;
      padding: 0 0.1rem;
      border-radius: 0.2rem;
    }
    .word:hover {
      color: var(--secondary);
      background-color: rgba(255, 107, 107, 0.1);
    }
    .tooltip {
      position: absolute;
      bottom: 100%;
      left: 50%;
      transform: translateX(-50%);
      background-color: var(--primary-light);
      color: var(--primary);
      padding: 0.5rem 1rem;
      border-radius: 0.5rem;
      font-size: 0.9rem;
      white-space: nowrap;
      opacity: 0;
      pointer-events: none;
      transition: opacity 0.3s ease;
      box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
      z-index: 10;
    }
    .word:hover .tooltip {
      opacity: 1;
    }
    .sentence-actions {
      display: flex;
      gap: 1rem;
      margin-top: 1rem;
    }
    .sentence-action {
      display: flex;
      align-items: center;
      background: none;
      border: none;
      color: var(--text-light);
      font-size: 0.9rem;
      cursor: pointer;
      transition: all 0.2s ease;
    }
    .sentence-action i {
      margin-right: 0.3rem;
    }
    .sentence-action:hover {
      color: var(--primary);
    }
    /* Per-sentence speak button positioned at bottom right */
    .speak-btn {
      position: absolute;
      bottom: 10px;
      right: 10px;
      border: none;
      background: var(--primary-light);
      cursor: pointer;
      padding: 0.5rem;
      border-radius: 50%;
      transition: all 0.3s ease;
      display: flex;
      align-items: center;
      justify-content: center;
      box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
    }
    .speak-btn:hover {
      background: var(--primary);
    }

    .speak-btn i {
      color: var(--primary);
    }

    .speak-btn:hover i {
      color: #fff;
    }
    
    .speak-btn img {
      width: 20px;
      height: 20px;
    }
    .loading {
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      min-height: 200px;
      gap: 1rem;
    }
    .spinner {
      width: 40px;
      height: 40px;
      border: 4px solid rgba(91, 104, 255, 0.2);
      border-left-color: var(--primary);
      border-radius: 50%;
      animation: spin 1s linear infinite;
    }
    .loading-text {
      color: var(--text-light);
      font-size: 0.9rem;
    }
    .processing-steps {
      margin-top: 1rem;
      font-size: 0.85rem;
      color: var(--text-light);
    }
    .processing-step {
      display: flex;
      align-items: center;
      margin-bottom: 0.4rem;
    }
    .processing-step.completed {
      color: var(--success);
    }
    .processing-step i {
      margin-right: 0.4rem;
    }
    .error {
      color: var(--danger);
      text-align: center;
      padding: 2rem;
      background-color: rgba(220, 53, 69, 0.1);
      border-radius: 0.5rem;
    }
    .error i {
      font-size: 2rem;
      margin-bottom: 1rem;
    }
    .error h3 {
      margin-bottom: 0.5rem;
    }
    .error p {
      margin-bottom: 1rem;
    }
    .retry-btn {
      display: inline-flex;
      align-items: center;
      justify-content: center;
      padding: 0.5rem 1rem;
      background: var(--danger);
      color: white;
      border: none;
      border-radius: 0.5rem;
      font-size: 0.9rem;
      font-weight: 500;
      cursor: pointer;
      transition: all 0.3s ease;
    }
    .retry-btn i {
      margin-right: 0.5rem;
      font-size: 0.9rem;
    }
    .retry-btn:hover {
      background: #c82333;
    }
    .saved-translations {
      background: var(--card-bg);
      border-radius: 1rem;
      margin-top: 2rem;
      padding: 1.5rem;
      animation: fadeIn 0.8s ease;
      box-shadow: 0 4px 10px rgba(0, 0, 0, 0.05);
      display: none;
    }
    .saved-translations.visible {
      display: block;
    }
    .saved-translations h2 {
      font-size: 1.25rem;
      margin-bottom: 1rem;
      display: flex;
      align-items: center;
    }
    .saved-translations h2 i {
      margin-right: 0.5rem;
      color: var(--primary);
    }
    .saved-list {
      max-height: 300px;
      overflow-y: auto;
    }
    .saved-item {
      padding: 1rem;
      border-bottom: 1px solid var(--border);
      cursor: pointer;
      transition: all 0.2s ease;
    }
    .saved-item:hover {
      background-color: var(--primary-light);
    }
    .saved-item:last-child {
      border-bottom: none;
    }
    .saved-item-header {
      display: flex;
      justify-content: space-between;
      margin-bottom: 0.5rem;
    }
    .saved-item-lang {
      font-weight: 500;
    }
    .saved-item-date {
      font-size: 0.85rem;
      color: var(--text-light);
    }
    .saved-item-text {
      font-size: 0.9rem;
      color: var(--text-light);
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }
    .no-saved {
      text-align: center;
      padding: 2rem;
      color: var(--text-light);
    }
    .no-saved i {
      font-size: 2rem;
      margin-bottom: 1rem;
      opacity: 0.5;
    }
    .top-controls {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 2rem;
    }
    .theme-toggle {
      background: none;
      border: none;
      font-size: 1.5rem;
      color: var(--text-light);
      cursor: pointer;
      transition: all 0.3s ease;
    }
    .theme-toggle:hover {
      color: var(--primary);
      transform: rotate(15deg);
    }
    footer {
      text-align: center;
      margin-top: 3rem;
      padding: 1.5rem;
      color: var(--text-light);
      border-top: 1px solid var(--border);
      font-size: 0.9rem;
    }
    footer p {
      margin-bottom: 1rem;
    }
    .social-links {
      display: flex;
      justify-content: center;
      gap: 1rem;
      margin-top: 1rem;
    }
    .social-link {
      font-size: 1.2rem;
      color: var(--text-light);
      transition: all 0.3s ease;
    }
    .social-link:hover {
      color: var(--primary);
      transform: translateY(-3px);
    }
    
    /* Grammar button and explanation styles */
    .grammar-btn {
      position: absolute;
      bottom: 45px;
      right: 10px;
      border: none;
      background: var(--primary-light);
      cursor: pointer;
      padding: 0.5rem;
      border-radius: 50%;
      transition: all 0.3s ease;
      display: flex;
      align-items: center;
      justify-content: center;
      box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
    }
    
    .grammar-btn:hover {
      background: var(--primary);
    }
    
    .grammar-btn i {
      color: var(--primary-dark);
    }
    
    .grammar-btn:hover i {
      color: white;
    }
    
    .grammar-explanation {
      display: none;
      background: var(--card-bg);
      border-left: 3px solid var(--primary);
      padding: 1rem;
      margin: 1rem 0;
      border-radius: 0.5rem;
      font-size: 0.95rem;
      line-height: 1.6;
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05);
      animation: fadeIn 0.3s ease;
    }
    
    .grammar-explanation.visible {
      display: block;
    }
    
    .grammar-title {
      font-weight: 600;
      margin-bottom: 0.5rem;
      color: var(--primary-dark);
      display: flex;
      align-items: center;
    }
    
    .grammar-title i {
      margin-right: 0.5rem;
    }
    
    .grammar-loading {
      display: flex;
      justify-content: center;
      align-items: center;
      padding: 1rem;
      color: var(--text-light);
    }
    
    .grammar-loading i {
      margin-right: 0.5rem;
    }
    
    .grammar-point {
      margin-bottom: 0.75rem;
      position: relative;
      padding-left: 1.5rem;
    }
    
    .grammar-point:before {
      content: "•";
      position: absolute;
      left: 0.5rem;
      color: var(--primary);
      font-weight: bold;
    }
    
    .grammar-highlight {
      background-color: rgba(91, 104, 255, 0.1);
      color: var(--primary-dark);
      padding: 0 0.3rem;
      border-radius: 0.2rem;
      font-weight: 500;
    }

    /* Romanization styles */
    .romanization {
      font-size: 1rem;
      color: var(--primary);
      margin-bottom: 1rem;
      font-style: italic;
      line-height: 1.8;
    }
    
    /* NEW STYLES FOR ALIGNED WORD-BY-WORD TRANSLATION */
    .aligned-translation {
      display: flex;
      flex-wrap: wrap;
      margin-bottom: 1.5rem;
      gap: 0.5rem 1rem;
    }
    
    .word-pair {
      display: flex;
      flex-direction: column;
      align-items: center;
      text-align: center;
      margin-bottom: 0.5rem;
    }
    
    .original-word {
      font-weight: 600;
      font-size: 1.2rem;
      color: var(--text);
      min-width: 40px;
    }
    
    .translation-word {
      font-size: 0.9rem;
      color: var(--primary);
      font-weight: 500;
      min-width: 40px;
    }
    
    .word-pair-divider {
      width: 100%;
      height: 1px;
      background-color: var(--border);
      margin: 0.15rem 0;
    }
    
    /* Display modes toggle */
    .display-toggle {
      display: flex;
      align-items: center;
      margin-bottom: 1rem;
    }
    
    .display-toggle label {
      margin-right: 0.5rem;
      font-size: 0.9rem;
      color: var(--text-light);
    }
    
    .toggle-btn {
      display: flex;
      background: var(--primary-light);
      border-radius: 1rem;
      padding: 0.2rem;
      cursor: pointer;
    }
    
    .toggle-option {
      padding: 0.3rem 0.6rem;
      font-size: 0.8rem;
      border-radius: 0.8rem;
      transition: all 0.3s ease;
    }
    
    .toggle-option.active {
      background: var(--primary);
      color: white;
      font-weight: 500;
    }
    
    @keyframes spin {
      to {
        transform: rotate(360deg);
      }
    }
    @keyframes fadeIn {
      from {
        opacity: 0;
      }
      to {
        opacity: 1;
      }
    }
    @keyframes slideUp {
      from {
        opacity: 0;
        transform: translateY(20px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }
    @keyframes pulse {
      0% {
        opacity: 1;
      }
      50% {
        opacity: 0.8;
      }
      100% {
        opacity: 1;
      }
    }
    @media (max-width: 768px) {
      .container {
        padding: 1rem;
      }
      .logo-text {
        font-size: 2.5rem;
      }
      .tagline {
        font-size: 1.1rem;
      }
      .language-controls {
        flex-direction: column;
        align-items: center;
        gap: 1rem;
      }
      .language-selector {
        width: 100%;
      }
      .output-area {
        padding: 1.5rem;
      }
      .sentence-block {
        padding: 1.5rem 1.5rem 2.5rem 1.5rem;
      }
      .original, .word-mapping {
        font-size: 1.1rem;
      }
      .btn-container {
        flex-direction: column;
      }
      .output-header {
        flex-direction: column;
        gap: 1rem;
      }
      .output-actions {
        justify-content: center;
      }
      .word-pair {
        min-width: 60px;
      }
    }
  </style>
</head>
<body>
  <div class="container">
    <div class="top-controls">
      <button id="theme-toggle" class="theme-toggle" title="Toggle dark mode">
        <i class="fas fa-moon"></i>
      </button>
      <button id="saved-toggle" class="action-btn">
        <i class="fas fa-history"></i> History
      </button>
    </div>
    <header>
      <div class="logo-container">
        <h1 class="logo-text">LinguaLens</h1>
        <span class="logo-badge">Beta</span>
      </div>
      <p class="tagline">Decode foreign languages with the Birkenbihl method and learn more effectively</p>
    </header>
    <div class="info-box">
      <div class="info-icon">
        <i class="fas fa-info-circle"></i>
      </div>
      <div class="info-content">
        <h3>About the Birkenbihl Method</h3>
        <p>The Birkenbihl method helps you learn languages by first understanding exactly what each word means in your native language. This "decoding" phase creates strong neural connections, making language acquisition more natural and effective.</p>
      </div>
    </div>
    <div class="controls-container">
      <div class="language-controls">
        <div class="language-selector">
          <label for="source-lang"><i class="fas fa-globe"></i> Source language:</label>
          <select id="source-lang">
            <option value="fr">French</option>
            <option value="es">Spanish</option>
            <option value="de">German</option>
            <option value="it">Italian</option>
            <option value="ja">Japanese</option>
            <option value="ru">Russian</option>
            <option value="zh">Chinese</option>
            <option value="ar">Arabic</option>
            <option value="pt">Portuguese</option>
            <option value="hi">Hindi</option>
            <option value="ko">Korean</option>
            <option value="tr">Turkish</option>
            <option value="nl">Dutch</option>
            <option value="pl">Polish</option>
            <option value="sv">Swedish</option>
            <option value="vi">Vietnamese</option>
            <option value="th">Thai</option>
            <option value="el">Greek</option>
            <option value="cs">Czech</option>
            <option value="ro">Romanian</option>
            <option value="hu">Hungarian</option>
            <option value="fi">Finnish</option>
            <option value="da">Danish</option>
            <option value="bg">Bulgarian</option>
            <option value="sk">Slovak</option>
            <option value="lt">Lithuanian</option>
            <option value="sl">Slovenian</option>
            <option value="lv">Latvian</option>
            <option value="et">Estonian</option>
            <option value="hr">Croatian</option>
            <option value="sr">Serbian</option>
            <option value="ukr">Ukrainian</option>
            <option value="he">Hebrew</option>
            <option value="id">Indonesian</option>
            <option value="ms">Malay</option>
            <option value="fil">Filipino</option>
            <option value="sw">Swahili</option>
            <option value="af">Afrikaans</option>
            <option value="sq">Albanian</option>
          </select>
        </div>
        <div class="language-selector">
          <label for="target-lang"><i class="fas fa-user"></i> Your language:</label>
          <select id="target-lang">
            <option value="en">English</option>
            <option value="fr">French</option>
            <option value="es">Spanish</option>
            <option value="de">German</option>
            <option value="it">Italian</option>
            <option value="ja">Japanese</option>
            <option value="ru">Russian</option>
            <option value="zh">Chinese</option>
            <option value="ar">Arabic</option>
            <option value="pt">Portuguese</option>
            <option value="hi">Hindi</option>
            <option value="ko">Korean</option>
            <option value="tr">Turkish</option>
            <option value="nl">Dutch</option>
            <option value="pl">Polish</option>
            <option value="sv">Swedish</option>
            <option value="vi">Vietnamese</option>
            <option value="th">Thai</option>
            <option value="el">Greek</option>
            <option value="cs">Czech</option>
            <option value="ro">Romanian</option>
            <option value="hu">Hungarian</option>
            <option value="fi">Finnish</option>
            <option value="da">Danish</option>
            <option value="bg">Bulgarian</option>
            <option value="sk">Slovak</option>
            <option value="lt">Lithuanian</option>
            <option value="sl">Slovenian</option>
            <option value="lv">Latvian</option>
            <option value="et">Estonian</option>
            <option value="hr">Croatian</option>
            <option value="sr">Serbian</option>
            <option value="ukr">Ukrainian</option>
            <option value="he">Hebrew</option>
            <option value="id">Indonesian</option>
            <option value="ms">Malay</option>
            <option value="fil">Filipino</option>
            <option value="sw">Swahili</option>
            <option value="af">Afrikaans</option>
            <option value="sq">Albanian</option>
          </select>
        </div>
      </div>
      
      <div class="quick-actions">
        <button class="action-btn" id="swap-languages">
          <i class="fas fa-exchange-alt"></i> Swap Languages
        </button>
        <button class="action-btn" id="clear-text">
          <i class="fas fa-trash-alt"></i> Clear Text
        </button>
      </div>
      <div class="input-area">
        <div class="textarea-container">
          <textarea id="source-text" placeholder="Paste your text in a foreign language here..."></textarea>
          <div class="character-count">0 / 15000</div>
        </div>
        
        <div class="example-texts">
          <div class="example-text" data-lang="fr">Simple French example</div>
          <div class="example-text" data-lang="es">Simple Spanish example</div>
          <div class="example-text" data-lang="de">Simple German example</div>
          <div class="example-text" data-lang="it">Simple Italian example</div>
          <div class="example-text" data-lang="zh">简单的中文例子</div>
          <div class="example-text" data-lang="ja">簡単な日本語の例</div>
          <div class="example-text" data-lang="ko">간단한 한국어 예시</div>
        </div>
        
        <div class="btn-container">
          <button id="process-btn" class="primary-button">
            <i class="fas fa-magic"></i> Process Text
          </button>
          <button id="save-btn" class="secondary-button">
            <i class="fas fa-bookmark"></i> Save Translation
          </button>
        </div>
      </div>
      <div class="output-area" id="results-container">
        <!-- Results will appear here -->
      </div>
    </div>
    
    <div class="saved-translations" id="saved-translations">
      <h2><i class="fas fa-history"></i> Translation History</h2>
      <div class="saved-list" id="saved-list">
        <!-- Saved translations will appear here -->
      </div>
    </div>
    
    <footer>
      <p>LinguaLens &copy; 2024 | A better way to learn languages</p>
      <div class="social-links">
        <a href="#" class="social-link" title="Twitter"><i class="fab fa-twitter"></i></a>
        <a href="#" class="social-link" title="GitHub"><i class="fab fa-github"></i></a>
        <a href="#" class="social-link" title="Discord"><i class="fab fa-discord"></i></a>
      </div>
    </footer>
  </div>

  <script>
    // Theme toggle functionality
    const themeToggle = document.getElementById('theme-toggle');
    themeToggle.addEventListener('click', () => {
      document.body.classList.toggle('dark-mode');
      const icon = themeToggle.querySelector('i');
      if (document.body.classList.contains('dark-mode')) {
        icon.classList.remove('fa-moon');
        icon.classList.add('fa-sun');
      } else {
        icon.classList.remove('fa-sun');
        icon.classList.add('fa-moon');
      }
    });

    // Saved translations toggle
    const savedToggle = document.getElementById('saved-toggle');
    const savedTranslations = document.getElementById('saved-translations');
    savedToggle.addEventListener('click', () => {
      savedTranslations.classList.toggle('visible');
    });

    // Character count
    const sourceText = document.getElementById('source-text');
    const characterCount = document.querySelector('.character-count');
    sourceText.addEventListener('input', () => {
      const count = sourceText.value.length;
      characterCount.textContent = `${count} / 15000`;
      if (count > 15000) {
        characterCount.style.color = 'var(--danger)';
        sourceText.value = sourceText.value.substring(0, 15000);
      } else {
        characterCount.style.color = 'var(--text-light)';
      }
    });

    // Swap languages
    const swapLanguages = document.getElementById('swap-languages');
    const sourceLang = document.getElementById('source-lang');
    const targetLang = document.getElementById('target-lang');
    swapLanguages.addEventListener('click', () => {
      const temp = sourceLang.value;
      sourceLang.value = targetLang.value;
      targetLang.value = temp;
    });

    // Clear text
    const clearText = document.getElementById('clear-text');
    clearText.addEventListener('click', () => {
      sourceText.value = '';
      characterCount.textContent = '0 / 15000';
    });

    // Example texts
    const exampleTexts = document.querySelectorAll('.example-text');
    const examples = {
      'fr': 'Je voudrais apprendre le français. C\'est une belle langue.',
      'es': 'Me gustaría aprender español. Es un idioma muy bonito.',
      'de': 'Ich möchte Deutsch lernen. Es ist eine schöne Sprache.',
      'it': 'Vorrei imparare l\'italiano. È una bella lingua.',
      'zh': '我想学习中文。这是一种美丽的语言。',
      'ja': '日本語を勉強したいです。とても美しい言語です。',
      'ko': '저는 한국어를 배우고 싶어요. 아름다운 언어입니다.'
    };
    exampleTexts.forEach(example => {
      example.addEventListener('click', () => {
        const lang = example.dataset.lang;
        sourceLang.value = lang;
        sourceText.value = examples[lang] || 'Example text';
        characterCount.textContent = `${sourceText.value.length} / 15000`;
      });
    });

    // Process text functionality
    const processBtn = document.getElementById('process-btn');
    const resultsContainer = document.getElementById('results-container');
    
    processBtn.addEventListener('click', processText);

    function processText() {
      const text = sourceText.value.trim();
      if (!text) {
        alert('Please enter some text to process.');
        return;
      }

      // Display loading state
      resultsContainer.innerHTML = `
        <div class="loading">
          <div class="spinner"></div>
          <div class="loading-text">Processing your text...</div>
          <div class="processing-steps">
            <div class="processing-step" id="step1">
              <i class="fas fa-circle-notch fa-spin"></i> Analyzing text structure
            </div>
            <div class="processing-step" id="step2">
              <i class="fas fa-circle-notch fa-spin"></i> Creating word-by-word translation
            </div>
            <div class="processing-step" id="step3">
              <i class="fas fa-circle-notch fa-spin"></i> Generating fluent translation
            </div>
          </div>
        </div>
      `;
      resultsContainer.classList.add('visible');

      // Simulate step completion
      setTimeout(() => document.getElementById('step1').classList.add('completed'), 1000);
      setTimeout(() => document.getElementById('step2').classList.add('completed'), 3000);
      setTimeout(() => document.getElementById('step3').classList.add('completed'), 4500);

      // Send request to backend
      fetch('/process', {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json',
        },
        body: JSON.stringify({
          text: text,
          sourceLang: sourceLang.value,
          targetLang: targetLang.value
        }),
      })
      .then(response => {
        const reader = response.body.getReader();
        const decoder = new TextDecoder();
        let buffer = '';
        
        // Create result container
        resultsContainer.innerHTML = `
          <div class="output-header">
            <h2 class="output-title">Translation Results</h2>
            <div class="output-actions">
              <button class="output-action" id="copy-all">
                <i class="fas fa-copy"></i> Copy All
              </button>
              <button class="output-action" id="download-results">
                <i class="fas fa-download"></i> Download
              </button>
              <div class="display-toggle">
                <label>Display:</label>
                <div class="toggle-btn">
                  <div class="toggle-option active" id="toggle-aligned">Aligned</div>
                  <div class="toggle-option" id="toggle-inline">Inline</div>
                </div>
              </div>
            </div>
          </div>
          <div id="sentences-container"></div>
        `;
        
        // Setup display toggle functionality
        setupDisplayToggle();
        
        // Setup stream reading
        function processStream() {
          return reader.read().then(({ done, value }) => {
            if (done) {
              if (buffer) {
                try {
                  const result = JSON.parse(buffer);
                  addSentenceToResults(result);
                } catch (e) {
                  console.error('Error parsing JSON:', e);
                }
              }
              return;
            }
            
            buffer += decoder.decode(value, { stream: true });
            const lines = buffer.split('\n');
            
            buffer = lines.pop(); // Keep the incomplete line in the buffer
            
            lines.forEach(line => {
              if (line.trim()) {
                try {
                  const result = JSON.parse(line);
                  addSentenceToResults(result);
                } catch (e) {
                  console.error('Error parsing JSON:', e);
                }
              }
            });
            
            return processStream();
          });
        }
        
        processStream();
      })
      .catch(error => {
        console.error('Error:', error);
        resultsContainer.innerHTML = `
          <div class="error">
            <i class="fas fa-exclamation-triangle"></i>
            <h3>Oops! Something went wrong.</h3>
            <p>${error.message || 'There was an error processing your text. Please try again.'}</p>
            <button class="retry-btn" onclick="processText()">
              <i class="fas fa-redo"></i> Try Again
            </button>
          </div>
        `;
      });
    }
    
    // Function to set up display toggle functionality
    function setupDisplayToggle() {
      const toggleAligned = document.getElementById('toggle-aligned');
      const toggleInline = document.getElementById('toggle-inline');
      
      toggleAligned.addEventListener('click', () => {
        toggleAligned.classList.add('active');
        toggleInline.classList.remove('active');
        document.querySelectorAll('.aligned-translation').forEach(el => el.style.display = 'flex');
        document.querySelectorAll('.word-mapping').forEach(el => el.style.display = 'none');
      });
      
      toggleInline.addEventListener('click', () => {
        toggleInline.classList.add('active');
        toggleAligned.classList.remove('active');
        document.querySelectorAll('.aligned-translation').forEach(el => el.style.display = 'none');
        document.querySelectorAll('.word-mapping').forEach(el => el.style.display = 'block');
      });
    }

    // Add a sentence to results
    let sentenceCounter = 0;
    
    function addSentenceToResults(result) {
      const sentencesContainer = document.getElementById('sentences-container');
      sentenceCounter++;
      
      // Create sentence block
      const sentenceBlock = document.createElement('div');
      sentenceBlock.className = 'sentence-block';
      
      // Create header with sentence number
      const sentenceHeader = document.createElement('div');
      sentenceHeader.className = 'sentence-header';
      sentenceHeader.innerHTML = `<span class="sentence-number">Sentence ${sentenceCounter}</span>`;
      
      // Create original text
      const original = document.createElement('div');
      original.className = 'original';
      original.textContent = result.original;
      
      // Create aligned word-by-word translation (NEW)
      const alignedTranslation = document.createElement('div');
      alignedTranslation.className = 'aligned-translation';
      
      // Split original text and wordByWord translation into words
      const originalWords = result.original.split(/\s+/);
      const translationWords = result.wordByWord.split(/\s+/);
      
      // For each word, create a word pair with original and translation vertically aligned
      for (let i = 0; i < Math.max(originalWords.length, translationWords.length); i++) {
        if (originalWords[i]) {
          const wordPair = document.createElement('div');
          wordPair.className = 'word-pair';
          
          const originalWord = document.createElement('div');
          originalWord.className = 'original-word';
          // Remove punctuation when looking up in wordTranslations
          const cleanWord = originalWords[i].replace(/[.,!?;:"'-]/g, '');
          originalWord.textContent = originalWords[i];
          
          const divider = document.createElement('div');
          divider.className = 'word-pair-divider';
          
          const translationWord = document.createElement('div');
          translationWord.className = 'translation-word';
          translationWord.textContent = translationWords[i] || '';
          
          // Set tooltip with exact translation if available in wordTranslations
          if (result.wordTranslations && result.wordTranslations[cleanWord]) {
            const tooltip = document.createElement('span');
            tooltip.className = 'tooltip';
            tooltip.textContent = result.wordTranslations[cleanWord];
            originalWord.appendChild(tooltip);
          }
          
          wordPair.appendChild(originalWord);
          wordPair.appendChild(divider);
          wordPair.appendChild(translationWord);
          alignedTranslation.appendChild(wordPair);
        }
      }
      
      // Create traditional word-by-word mapping (for toggle option)
      const wordMapping = document.createElement('div');
      wordMapping.className = 'word-mapping';
      wordMapping.style.display = 'none'; // Hidden by default, aligned view is default
      wordMapping.textContent = result.wordByWord;
      
      // Create fluent translation
      const translation = document.createElement('div');
      translation.className = 'translation';
      translation.textContent = result.fluentTranslation;
      
      // Add romanization if available (for languages like Chinese, Japanese, Korean)
      let romanization = '';
      if (result.romanization) {
        romanization = `
          <div class="romanization">
            ${result.romanization}
          </div>
        `;
      }
      
      // Create grammar explanation button and container
      const grammarBtn = document.createElement('button');
      grammarBtn.className = 'grammar-btn';
      grammarBtn.innerHTML = '<i class="fas fa-book"></i>';
      grammarBtn.title = 'Show grammar explanation';
      
      const grammarExplanation = document.createElement('div');
      grammarExplanation.className = 'grammar-explanation';
      grammarExplanation.id = `grammar-${sentenceCounter}`;
      grammarExplanation.innerHTML = `
        <div class="grammar-loading">
          <i class="fas fa-circle-notch fa-spin"></i> Loading grammar explanation...
        </div>
      `;
      
      // Create speak button
      const speakBtn = document.createElement('button');
      speakBtn.className = 'speak-btn';
      speakBtn.innerHTML = '<i class="fas fa-volume-up"></i>';
      speakBtn.title = 'Listen to pronunciation';
      
      // Add event listener for grammar button
      grammarBtn.addEventListener('click', function() {
        const explanationDiv = document.getElementById(`grammar-${sentenceCounter}`);
        explanationDiv.classList.toggle('visible');
        
        // If it's the first time showing, fetch grammar explanation
        if (explanationDiv.querySelector('.grammar-loading')) {
          fetch('/grammar-explanation', {
            method: 'POST',
            headers: {
              'Content-Type': 'application/json',
            },
            body: JSON.stringify({
              sentence: result.original,
              sourceLang: sourceLang.value,
              targetLang: targetLang.value
            }),
          })
          .then(response => response.json())
          .then(data => {
            let html = `<div class="grammar-title"><i class="fas fa-book"></i> Grammar Breakdown</div>`;
            
            if (data.points && data.points.length > 0) {
              data.points.forEach(point => {
                // Replace ** with grammar-highlight class
                const formattedPoint = point.replace(/\*\*(.*?)\*\*/g, '<span class="grammar-highlight">$1</span>');
                html += `<div class="grammar-point">${formattedPoint}</div>`;
              });
            } else {
              html = `<div class="grammar-title"><i class="fas fa-info-circle"></i> Note</div>
                     <div class="grammar-point">No specific grammar points to highlight in this simple sentence.</div>`;
            }
            
            explanationDiv.innerHTML = html;
          })
          .catch(error => {
            explanationDiv.innerHTML = `
              <div class="grammar-title"><i class="fas fa-exclamation-triangle"></i> Error</div>
              <div class="grammar-point">Could not load grammar explanation. Please try again.</div>
            `;
          });
        }
      });
      
      // Add event listener for speak button
      speakBtn.addEventListener('click', function() {
        const utterance = new SpeechSynthesisUtterance(result.original);
        utterance.lang = getLanguageCode(sourceLang.value);
        speechSynthesis.speak(utterance);
      });
      
      // Assemble sentence block
      sentenceBlock.appendChild(sentenceHeader);
      sentenceBlock.appendChild(original);
      sentenceBlock.appendChild(alignedTranslation);
      sentenceBlock.appendChild(wordMapping);
      if (romanization) {
        const romanizationDiv = document.createElement('div');
        romanizationDiv.className = 'romanization';
        romanizationDiv.textContent = result.romanization;
        sentenceBlock.appendChild(romanizationDiv);
      }
      sentenceBlock.appendChild(translation);
      sentenceBlock.appendChild(grammarExplanation);
      sentenceBlock.appendChild(grammarBtn);
      sentenceBlock.appendChild(speakBtn);
      
      // Add the sentence block to the container
      sentencesContainer.appendChild(sentenceBlock);
    }
    
    // Helper function to get full language code for speech synthesis
    function getLanguageCode(code) {
      const langMap = {
        'en': 'en-US',
        'fr': 'fr-FR',
        'es': 'es-ES',
        'de': 'de-DE',
        'it': 'it-IT',
        'ja': 'ja-JP',
        'ru': 'ru-RU',
        'zh': 'zh-CN',
        'ar': 'ar-SA',
        'pt': 'pt-BR',
        'hi': 'hi-IN',
        'ko': 'ko-KR'
      };
      return langMap[code] || code;
    }
    
    // Save translation functionality
    const saveBtn = document.getElementById('save-btn');
    saveBtn.addEventListener('click', () => {
      const text = sourceText.value.trim();
      if (!text) {
        alert('No text to save.');
        return;
      }
      
      // Get existing saved translations
      let savedItems = JSON.parse(localStorage.getItem('savedTranslations') || '[]');
      
      // Add new translation
      savedItems.unshift({
        text: text.substring(0, 100) + (text.length > 100 ? '...' : ''),
        sourceLang: sourceLang.value,
        targetLang: targetLang.value,
        date: new Date().toLocaleString(),
        fullText: text
      });
      
      // Keep only the most recent 10 items
      if (savedItems.length > 10) {
        savedItems = savedItems.slice(0, 10);
      }
      
      // Save to localStorage
      localStorage.setItem('savedTranslations', JSON.stringify(savedItems));
      
      // Update the UI
      updateSavedTranslations();
      
      // Show confirmation
      alert('Translation saved!');
    });
    
    // Update saved translations list
    function updateSavedTranslations() {
      const savedList = document.getElementById('saved-list');
      const savedItems = JSON.parse(localStorage.getItem('savedTranslations') || '[]');
      
      if (savedItems.length === 0) {
        savedList.innerHTML = `
          <div class="no-saved">
            <i class="fas fa-history"></i>
            <p>No saved translations yet</p>
          </div>
        `;
        return;
      }
      
      savedList.innerHTML = savedItems.map((item, index) => `
        <div class="saved-item" data-index="${index}">
          <div class="saved-item-header">
            <span class="saved-item-lang">${getLanguageName(item.sourceLang)} → ${getLanguageName(item.targetLang)}</span>
            <span class="saved-item-date">${item.date}</span>
          </div>
          <div class="saved-item-text">${item.text}</div>
        </div>
      `).join('');
      
      // Add click event to load saved translation
      document.querySelectorAll('.saved-item').forEach(item => {
        item.addEventListener('click', () => {
          const index = item.dataset.index;
          const savedItem = savedItems[index];
          
          sourceLang.value = savedItem.sourceLang;
          targetLang.value = savedItem.targetLang;
          sourceText.value = savedItem.fullText;
          characterCount.textContent = `${sourceText.value.length} / 15000`;
          
          // Hide saved translations panel
          savedTranslations.classList.remove('visible');
          
          // Process the text automatically
          processText();
        });
      });
    }
    
    // Helper function to get language name
    function getLanguageName(code) {
      const langNames = {
        'en': 'English', 'fr': 'French', 'es': 'Spanish', 'de': 'German',
        'it': 'Italian', 'ja': 'Japanese', 'ru': 'Russian', 'zh': 'Chinese',
        'ar': 'Arabic', 'pt': 'Portuguese', 'hi': 'Hindi', 'ko': 'Korean'
      };
      return langNames[code] || code.toUpperCase();
    }
    
    // Initialize saved translations
    updateSavedTranslations();
    
    // Check for dark mode preference
    if (window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches) {
      document.body.classList.add('dark-mode');
      themeToggle.querySelector('i').classList.remove('fa-moon');
      themeToggle.querySelector('i').classList.add('fa-sun');
    }
  </script>
</body>
</html>
